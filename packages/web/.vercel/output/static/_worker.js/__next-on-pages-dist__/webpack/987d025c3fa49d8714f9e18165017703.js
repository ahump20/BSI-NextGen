var L={},_a=(Oa,Ba,Ua)=>(L.__chunk_7245=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.SportsDataService=void 0;let E=C(190),w=C(1605),g=C(8184),o=C(9702),n=C(7399);class l{constructor(){this.mlb=new E.MLBAdapter,this.nfl=new w.NFLAdapter,this.nba=new g.NBAAdapter,this.ncaaFootball=new o.NCAAFootballAdapter,this.collegeBaseball=new n.CollegeBaseballAdapter}async getTeams(S){switch(S){case"MLB":return this.mlb.getTeams();case"NFL":return this.nfl.getTeams();case"NBA":return this.nba.getTeams();case"NCAA_FOOTBALL":return this.ncaaFootball.getTeams();case"COLLEGE_BASEBALL":return{data:[],source:{provider:"ESPN API",timestamp:new Date().toISOString(),confidence:1}};default:throw Error(`Unsupported sport: ${S}`)}}async getStandings(S,c){switch(S){case"MLB":return this.mlb.getStandings(c?.divisionId);case"NFL":return this.nfl.getStandings(c?.season||2025);case"NBA":return this.nba.getStandings(c?.season||"2025");case"NCAA_FOOTBALL":return this.ncaaFootball.getStandings(c?.conference);case"COLLEGE_BASEBALL":return this.collegeBaseball.getStandings(c?.conference);default:throw Error(`Unsupported sport: ${S}`)}}async getGames(S,c){switch(S){case"MLB":return this.mlb.getGames(c?.date);case"NFL":return this.nfl.getGames({season:c?.season||2025,week:c?.week||1});case"NBA":return this.nba.getGames(c?.date);case"NCAA_FOOTBALL":return this.ncaaFootball.getGames({week:c?.week,season:c?.season||2025});case"COLLEGE_BASEBALL":return this.collegeBaseball.getGames({date:c?.date});default:throw Error(`Unsupported sport: ${S}`)}}async getAllLiveGames(){let[S,c,m,f,b]=await Promise.allSettled([this.mlb.getGames(),this.nfl.getGames({season:2025,week:1}),this.nba.getGames(),this.ncaaFootball.getGames(),this.collegeBaseball.getGames()]),u=[];return S.status==="fulfilled"&&u.push(...S.value.data.filter(p=>p.status==="live")),c.status==="fulfilled"&&u.push(...c.value.data.filter(p=>p.status==="live")),m.status==="fulfilled"&&u.push(...m.value.data.filter(p=>p.status==="live")),f.status==="fulfilled"&&u.push(...f.value.data.filter(p=>p.status==="live")),b.status==="fulfilled"&&u.push(...b.value.data.filter(p=>p.status==="live")),{data:u,source:{provider:"Blaze Sports Intel - Aggregated",timestamp:new Date().toISOString(),confidence:1}}}}A.SportsDataService=l},L.__chunk_1198=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.orchestrator=A.LeagueOrchestrator=void 0;let E=C(190),w=C(1605),g=C(8184),o=C(9702),n=C(7399),l=C(6164);class h{constructor(c){this.adapters=new Map([["MLB",new E.MLBAdapter],["NFL",new w.NFLAdapter(c?.sportsDataIOKey)],["NBA",new g.NBAAdapter(c?.sportsDataIOKey)],["NCAA_FOOTBALL",new o.NCAAFootballAdapter],["COLLEGE_BASEBALL",new n.CollegeBaseballAdapter]])}async getAllGames(c){let m=c||this.getTodayInChicago(),f=await Promise.allSettled([this.getMLBGames(m),this.getNFLGames(m),this.getNBAGames(m),this.getNCAAFootballGames(m),this.getCollegeBaseballGames(m)]),b=[],u=[],p=[];f.forEach((W,B)=>{if(W.status==="fulfilled"&&W.value)b.push(...W.value.data),u.push(W.value.source);else if(W.status==="rejected"){let ee=this.getLeagueByIndex(B);p.push({sport:ee,message:W.reason?.message||"Unknown error"}),console.error(`[LeagueOrchestrator] Failed to fetch ${ee} games:`,W.reason)}}),b.sort((W,B)=>new Date(W.date).getTime()-new Date(B.date).getTime());let I=u.length>0?u.reduce((W,B)=>W+B.confidence,0)/u.length:0;return{data:b,sources:u,aggregatedConfidence:I,timestamp:(0,l.getChicagoTimestamp)(),errors:p.length>0?p:void 0}}async getAllStandings(){let c=await Promise.allSettled([this.adapters.get("MLB")?.getStandings(),this.adapters.get("NFL")?.getStandings(2025),this.adapters.get("NBA")?.getStandings("2025")]),m=[],f=[],b=[];c.forEach((p,I)=>{if(p.status==="fulfilled"&&p.value)m.push(...p.value.data),f.push(p.value.source);else if(p.status==="rejected"){let W=this.getLeagueByIndex(I);b.push({sport:W,message:p.reason?.message||"Unknown error"})}});let u=f.length>0?f.reduce((p,I)=>p+I.confidence,0)/f.length:0;return{data:m,sources:f,aggregatedConfidence:u,timestamp:(0,l.getChicagoTimestamp)(),errors:b.length>0?b:void 0}}async getAllTeams(){let c=await Promise.allSettled([this.adapters.get("MLB")?.getTeams(),this.adapters.get("NFL")?.getTeams(),this.adapters.get("NBA")?.getTeams()]),m=[],f=[],b=[];c.forEach((p,I)=>{if(p.status==="fulfilled"&&p.value)m.push(...p.value.data),f.push(p.value.source);else if(p.status==="rejected"){let W=this.getLeagueByIndex(I);b.push({sport:W,message:p.reason?.message||"Unknown error"})}});let u=f.length>0?f.reduce((p,I)=>p+I.confidence,0)/f.length:0;return{data:m,sources:f,aggregatedConfidence:u,timestamp:(0,l.getChicagoTimestamp)(),errors:b.length>0?b:void 0}}async search(c){let m=c.toLowerCase().trim();if(!m)return[];let f=await this.getAllTeams(),b=[];return f.data.forEach(u=>{let p=this.calculateRelevance(u,m);p>0&&b.push({sport:this.inferSportFromTeam(u),type:"team",id:u.id,name:u.name,relevanceScore:p,metadata:{abbreviation:u.abbreviation,city:u.city,conference:u.conference,division:u.division,logo:u.logo}})}),b.sort((u,p)=>p.relevanceScore-u.relevanceScore),b}async getLiveGames(){let c=await this.getAllGames();return{data:c.data.filter(m=>m.status==="live"),sources:c.sources,aggregatedConfidence:c.aggregatedConfidence,timestamp:(0,l.getChicagoTimestamp)(),errors:c.errors}}async getGamesByLeague(c,m){let f=this.adapters.get(c);if(!f)throw Error(`No adapter found for sport: ${c}`);return f.getGames(m)}async getStandingsByLeague(c,m){let f=this.adapters.get(c);if(!f)throw Error(`No adapter found for sport: ${c}`);return f.getStandings(m)}async getTeamsByLeague(c){let m=this.adapters.get(c);if(!m)throw Error(`No adapter found for sport: ${c}`);return m.getTeams()}async getMLBGames(c){return this.adapters.get("MLB").getGames(c)}async getNFLGames(c){let m=this.getCurrentNFLWeek();return this.adapters.get("NFL").getGames({season:2025,week:m})}async getNBAGames(c){return this.adapters.get("NBA").getGames(c)}async getNCAAFootballGames(c){let m=this.getCurrentNCAAWeek();return this.adapters.get("NCAA_FOOTBALL").getGames(m)}async getCollegeBaseballGames(c){return this.adapters.get("COLLEGE_BASEBALL").getGames(c)}calculateRelevance(c,m){let f=0,b=c.name.toLowerCase(),u=c.city.toLowerCase(),p=c.abbreviation.toLowerCase();return b===m||p===m?f=1:b.startsWith(m)||u.startsWith(m)?f=.8:b.includes(m)||u.includes(m)?f=.6:p.includes(m)&&(f=.4),f}inferSportFromTeam(c){return c.division?.includes("AL")||c.division?.includes("NL")?"MLB":c.conference==="AFC"||c.conference==="NFC"?"NFL":c.conference==="Eastern"||c.conference==="Western"?"NBA":"MLB"}getLeagueByIndex(c){return["MLB","NFL","NBA","NCAA_FOOTBALL","COLLEGE_BASEBALL"][c]||"MLB"}getCurrentNFLWeek(){let c=new Date,m=c.getMonth(),f=c.getDate();return m===8?1:m===9?5:m===10?9:m===11?13:m===0&&f<8?18:1}getCurrentNCAAWeek(){let c=new Date().getMonth();return c===7?1:c===8?4:c===9?8:c===10?12:c===11||c===0?15:1}getTodayInChicago(){let c=new Date,[m,f,b]=new Intl.DateTimeFormat("en-US",{timeZone:"America/Chicago",year:"numeric",month:"2-digit",day:"2-digit"}).format(c).split("/");return`${b}-${m}-${f}`}}A.LeagueOrchestrator=h,A.orchestrator=new h({sportsDataIOKey:"6ca2adb39404482da5406f0a6cd7aa37"})},L.__chunk_790=($,A,C)=>{var E=Object.create?function(g,o,n,l){l===void 0&&(l=n);var h=Object.getOwnPropertyDescriptor(o,n);(!h||("get"in h?!o.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return o[n]}}),Object.defineProperty(g,l,h)}:function(g,o,n,l){l===void 0&&(l=n),g[l]=o[n]},w=function(g,o){for(var n in g)n==="default"||Object.prototype.hasOwnProperty.call(o,n)||E(o,g,n)};Object.defineProperty(A,"__esModule",{value:!0}),w(C(190),A),w(C(1605),A),w(C(8184),A),w(C(9702),A),w(C(7399),A),w(C(3242),A),w(C(320),A),w(C(1198),A),w(C(7245),A),w(C(3140),A),w(C(1964),A),w(C(6609),A)},L.__chunk_965=($,A)=>{function C(o){let{sport:n,endpoint:l,params:h={}}=o,S=Object.entries(h).sort(([c],[m])=>c.localeCompare(m)).map(([c,m])=>`${c}=${m}`).join(":");return S?`bsi:${n}:${l}:${S}`:`bsi:${n}:${l}`}Object.defineProperty(A,"__esModule",{value:!0}),A.SportsCache=void 0,A.generateCacheKey=C,A.createSportsCache=function(o){return new g(o)},A.isKVNamespace=function(o){return o&&typeof o.get=="function"&&typeof o.put=="function"},A.withCache=function(o,n){return async l=>{let h=new URL(l.url),S={};return h.searchParams.forEach((c,m)=>{S[m]=c}),l.headers.get("Cache-Control")?.includes("no-cache"),o(l)}};class E{constructor(){this.cache=new Map,this.stats={hits:0,misses:0,latencies:[]}}async get(n){let l=Date.now(),h=this.cache.get(n);return h?h.expiresAt<Date.now()?(this.cache.delete(n),this.stats.misses++,null):(this.stats.hits++,this.stats.latencies.push(Date.now()-l),h):(this.stats.misses++,null)}async set(n,l){if(this.cache.set(n,l),this.cache.size%100==0){let h=Date.now();for(let[S,c]of this.cache.entries())c.expiresAt<h&&this.cache.delete(S)}}async delete(n){this.cache.delete(n)}async clear(){this.cache.clear(),this.stats={hits:0,misses:0,latencies:[]}}getStats(){let n=this.stats.hits+this.stats.misses,l=n>0?this.stats.hits/n:0,h=this.stats.latencies.length>0?this.stats.latencies.reduce((S,c)=>S+c,0)/this.stats.latencies.length:0;return{hits:this.stats.hits,misses:this.stats.misses,hitRate:l,totalRequests:n,averageLatency:h}}}let w=new E;class g{constructor(n){this.kv=null,this.kv=n||null}async get(n){if(n.forceFresh)return null;let l=C(n);if(this.kv)try{let S=await this.kv.get(l,"json");if(S&&S.expiresAt>Date.now())return S.data}catch(S){console.error("[SportsCache] KV get error:",S)}return(await w.get(l))?.data||null}async set(n,l){let{ttl:h=300,sport:S,endpoint:c}=l,m=C(l),f=Date.now(),b={data:n,timestamp:f,expiresAt:f+1e3*h,sport:S,endpoint:c,cacheKey:m};if(this.kv)try{await this.kv.put(m,JSON.stringify(b),{expirationTtl:h})}catch(u){console.error("[SportsCache] KV set error:",u)}await w.set(m,b)}async invalidate(n){let l=C(n);if(this.kv)try{await this.kv.delete(l)}catch(h){console.error("[SportsCache] KV delete error:",h)}await w.delete(l)}async invalidateSport(n){await w.clear()}getStats(){return w.getStats()}async wrap(n,l){let h=await this.get(l);if(h!==null)return h;let S=await n();return await this.set(S,l),S}}A.SportsCache=g},L.__chunk_3140=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.withCache=A.isKVNamespace=A.generateCacheKey=A.createSportsCache=A.SportsCache=void 0;var E=C(965);Object.defineProperty(A,"SportsCache",{enumerable:!0,get:function(){return E.SportsCache}}),Object.defineProperty(A,"createSportsCache",{enumerable:!0,get:function(){return E.createSportsCache}}),Object.defineProperty(A,"generateCacheKey",{enumerable:!0,get:function(){return E.generateCacheKey}}),Object.defineProperty(A,"isKVNamespace",{enumerable:!0,get:function(){return E.isKVNamespace}}),Object.defineProperty(A,"withCache",{enumerable:!0,get:function(){return E.withCache}})},L.__chunk_1964=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.createJWT=w,A.verifyJWT=g,A.verifyAuth0JWT=o,A.extractBearerToken=function(n){return n&&n.startsWith("Bearer ")?n.substring(7):null};let E=C(5540);async function w(n,l){let h=new TextEncoder().encode(l.secret);return await new E.SignJWT({sub:n.id,email:n.email,role:n.role}).setProtectedHeader({alg:"HS256"}).setIssuedAt().setIssuer(l.issuer).setAudience(l.audience).setExpirationTime(l.expiresIn||"7d").sign(h)}async function g(n,l){try{let h=new TextEncoder().encode(l.secret),{payload:S}=await(0,E.jwtVerify)(n,h,{issuer:l.issuer,audience:l.audience});return!S.sub||!S.email||!S.role?null:{id:S.sub,email:S.email,role:S.role}}catch(h){return console.error("JWT verification failed:",h),null}}async function o(n,l,h){try{let S=await(0,E.importSPKI)(l,"RS256"),{payload:c}=await(0,E.jwtVerify)(n,S,{issuer:h.issuer,audience:h.audience});return!c.sub||!c.email?null:{id:c.sub,email:c.email,role:c.role||"user"}}catch(S){return console.error("Auth0 JWT verification failed:",S),null}}},L.__chunk_6609=($,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.Auth0Client=void 0,A.createAuth0Client=function(E){return new C(E)};class C{constructor(w){this.config=w}getAuthorizationUrl(w,g="openid profile email"){let o=new URLSearchParams({response_type:"code",client_id:this.config.clientId,redirect_uri:this.config.redirectUri,scope:g,state:w,...this.config.audience&&{audience:this.config.audience}});return`https://${this.config.domain}/authorize?${o.toString()}`}async exchangeCodeForTokens(w){let g=await fetch(`https://${this.config.domain}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"authorization_code",client_id:this.config.clientId,client_secret:this.config.clientSecret,code:w,redirect_uri:this.config.redirectUri})});if(!g.ok){let o=await g.json();throw Error(`Token exchange failed: ${o.error_description||o.error||"Unknown error"}`)}return g.json()}async getUserInfo(w){let g=await fetch(`https://${this.config.domain}/userinfo`,{headers:{Authorization:`Bearer ${w}`}});if(!g.ok)throw Error("Failed to fetch user info");return g.json()}async revokeToken(w){if(!(await fetch(`https://${this.config.domain}/oauth/revoke`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:this.config.clientId,client_secret:this.config.clientSecret,token:w})})).ok)throw Error("Failed to revoke token")}getLogoutUrl(w){let g=new URLSearchParams({client_id:this.config.clientId,returnTo:w});return`https://${this.config.domain}/v2/logout?${g.toString()}`}}A.Auth0Client=C},L.__chunk_1605=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.NFLAdapter=void 0;let E=C(6164);class w{constructor(o){this.baseUrl="https://api.sportsdata.io/v3/nfl",this.apiKey=(0,E.validateApiKey)(o||"6ca2adb39404482da5406f0a6cd7aa37","SportsDataIO (NFL)")}getCurrentSeason(){let o=new Date;return 7>o.getMonth()?o.getFullYear()-1:o.getFullYear()}async getTeams(){return(0,E.retryWithBackoff)(async()=>{let o=await(0,E.fetchWithTimeout)(`${this.baseUrl}/scores/json/Teams`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}},1e4);if(!o.ok)throw Error(`NFL API error: ${o.statusText}`);return{data:(await o.json()).map(n=>({id:n.TeamID.toString(),name:n.Name,abbreviation:n.Key,city:n.City,logo:n.WikipediaLogoUrl,division:n.Division,conference:n.Conference})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getStandings(o){return(0,E.retryWithBackoff)(async()=>{let n=o??this.getCurrentSeason(),l=await(0,E.fetchWithTimeout)(`${this.baseUrl}/scores/json/Standings/${n}`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}},1e4);if(!l.ok)throw Error(`NFL API error: ${l.statusText}`);return{data:(await l.json()).map(h=>({team:{id:h.TeamID.toString(),name:h.Name,abbreviation:h.Team,city:h.City,division:h.Division,conference:h.Conference},wins:h.Wins,losses:h.Losses,winPercentage:h.Percentage,streak:h.Streak>0?`W${h.Streak}`:`L${Math.abs(h.Streak)}`})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getGames(o){let n=this.getCurrentSeason(),l=typeof o=="object"?o?.season??n:o??n,h=typeof o=="object"?o?.week??1:1;return(0,E.retryWithBackoff)(async()=>{let S=await(0,E.fetchWithTimeout)(`${this.baseUrl}/scores/json/ScoresByWeek/${l}/${h}`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}},1e4);if(!S.ok)throw Error(`NFL API error: ${S.statusText}`);return{data:(await S.json()).map(c=>({id:c.GameKey,sport:"NFL",date:c.DateTime,status:this.mapGameStatus(c.Status),homeTeam:{id:c.HomeTeamID?.toString()||"",name:c.HomeTeam,abbreviation:c.HomeTeam,city:""},awayTeam:{id:c.AwayTeamID?.toString()||"",name:c.AwayTeam,abbreviation:c.AwayTeam,city:""},homeScore:c.HomeScore||0,awayScore:c.AwayScore||0,period:c.Quarter?`Q${c.Quarter}`:void 0,venue:c.StadiumDetails?.Name})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}mapGameStatus(o){switch(o){case"Final":case"F/OT":return"final";case"InProgress":case"Halftime":return"live";case"Scheduled":default:return"scheduled";case"Postponed":return"postponed";case"Canceled":return"cancelled"}}}A.NFLAdapter=w},L.__chunk_9702=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.NCAAFootballAdapter=void 0;let E=C(6164);class w{constructor(){this.baseUrl="https://site.api.espn.com/apis/site/v2/sports/football/college-football"}getCurrentSeason(){let o=new Date;return 7>o.getMonth()?o.getFullYear()-1:o.getFullYear()}async getTeams(o){return(0,E.retryWithBackoff)(async()=>{let n=o?`${this.baseUrl}/teams?group=${o}`:`${this.baseUrl}/teams?group=80`,l=await fetch(n,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!l.ok)throw Error(`ESPN API error: ${l.statusText}`);let h=await l.json(),S=[];return h.sports?.[0]?.leagues?.[0]?.teams?.forEach(c=>{let m=c.team;S.push({id:m.id,name:m.displayName,abbreviation:m.abbreviation,city:m.location,logo:m.logos?.[0]?.href,conference:m.groups?.[0]?.name})}),{data:S,source:{provider:"ESPN API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getStandings(o){return(0,E.retryWithBackoff)(async()=>{let n=o?`${this.baseUrl}/standings?group=${o}`:`${this.baseUrl}/standings`,l=await fetch(n,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!l.ok)throw Error(`ESPN API error: ${l.statusText}`);let h=await l.json(),S=[];return h.children?.forEach(c=>{c.standings?.entries?.forEach(m=>{let f=m.stats||[];S.push({team:{id:m.team?.id||"",name:m.team?.displayName||"",abbreviation:m.team?.abbreviation||"",city:m.team?.location||"",logo:m.team?.logos?.[0]?.href,conference:c.name},wins:parseInt(f.find(b=>b.name==="wins")?.value||"0"),losses:parseInt(f.find(b=>b.name==="losses")?.value||"0"),winPercentage:parseFloat(f.find(b=>b.name==="winPercent")?.value||"0"),streak:f.find(b=>b.name==="streak")?.displayValue})})}),{data:S,source:{provider:"ESPN API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getGames(o){let n=typeof o=="object"?o?.week:o,l=typeof o=="object"?o?.season??this.getCurrentSeason():this.getCurrentSeason();return(0,E.retryWithBackoff)(async()=>{let h=n?`${this.baseUrl}/scoreboard?week=${n}&seasontype=2&year=${l}`:`${this.baseUrl}/scoreboard`,S=await fetch(h,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!S.ok)throw Error(`ESPN API error: ${S.statusText}`);return{data:((await S.json()).events||[]).map(c=>{let m=c.competitions?.[0],f=m?.competitors?.find(u=>u.homeAway==="home"),b=m?.competitors?.find(u=>u.homeAway==="away");return{id:c.id,sport:"NCAA_FOOTBALL",date:c.date,status:this.mapGameStatus(c.status?.type?.name),homeTeam:{id:f?.team?.id||"",name:f?.team?.displayName||"",abbreviation:f?.team?.abbreviation||"",city:f?.team?.location||"",logo:f?.team?.logo||""},awayTeam:{id:b?.team?.id||"",name:b?.team?.displayName||"",abbreviation:b?.team?.abbreviation||"",city:b?.team?.location||"",logo:b?.team?.logo||""},homeScore:parseInt(f?.score||"0"),awayScore:parseInt(b?.score||"0"),period:c.status?.period?`Q${c.status.period}`:void 0,venue:m?.venue?.fullName}}),source:{provider:"ESPN API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}mapGameStatus(o){switch(o?.toLowerCase()){case"status.type.final":return"final";case"status.type.inprogress":return"live";case"status.type.scheduled":case"status.type.pre":default:return"scheduled";case"status.type.postponed":return"postponed";case"status.type.canceled":return"cancelled"}}}A.NCAAFootballAdapter=w},L.__chunk_3242=($,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.NCAAAdapter=void 0,A.createNCAAAdapter=function(E){return new C(E)};class C{constructor(w={}){this.config={apiKey:w.apiKey||"",baseURL:w.baseURL||"https://site.api.espn.com/apis/site/v2/sports/baseball/college-baseball",timeout:w.timeout||1e4},this.headers={"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}}}async getGames(w){let g=new URLSearchParams;w&&g.append("dates",w.replace(/-/g,""));let o=`${this.config.baseURL}/scoreboard${g.toString()?`?${g}`:""}`,n=await this.fetchWithTimeout(o,{headers:this.headers}),l=await n.json();return this.transformGamesList(l)}async getGame(w){let g=await this.fetchWithTimeout(`${this.config.baseURL}/summary?event=${w}`,{headers:this.headers}),o=await g.json();return this.transformGameData(o)}transformGamesList(w){return w.events&&Array.isArray(w.events)?w.events.map(g=>{let o=g.competitions?.[0],n=o?.competitors?.find(h=>h.homeAway==="home"),l=o?.competitors?.find(h=>h.homeAway==="away");return{id:g.id,date:g.date,name:g.name,shortName:g.shortName,status:{type:o?.status?.type?.name||"scheduled",detail:o?.status?.type?.detail||"",completed:o?.status?.type?.completed||!1,inning:o?.status?.period||0,inningHalf:o?.status?.type?.shortDetail?.includes("Top")?"top":"bottom"},teams:{home:{id:n?.team?.id||"",name:n?.team?.displayName||"",abbreviation:n?.team?.abbreviation||"",logo:n?.team?.logo||"",score:parseInt(n?.score||"0",10),record:n?.records?.[0]?.summary||"0-0",conference:n?.team?.conferenceId||""},away:{id:l?.team?.id||"",name:l?.team?.displayName||"",abbreviation:l?.team?.abbreviation||"",logo:l?.team?.logo||"",score:parseInt(l?.score||"0",10),record:l?.records?.[0]?.summary||"0-0",conference:l?.team?.conferenceId||""}},venue:{name:o?.venue?.fullName||"",city:o?.venue?.address?.city||"",state:o?.venue?.address?.state||""}}}):[]}transformGameData(w){let g=w.header,o=w.boxscore,n=o?.teams?.[0],l=o?.teams?.[1],h=(b,u)=>u>0?(b/u).toFixed(3):".000",S=(b,u)=>u>0?(9*b/u).toFixed(2):"0.00",c=b=>b&&Array.isArray(b)?b.map(u=>({name:u.athlete?.displayName||"Unknown",position:u.athlete?.position?.abbreviation||"",atBats:parseInt(u.stats?.find(p=>p.name==="AB")?.value||"0",10),runs:parseInt(u.stats?.find(p=>p.name==="R")?.value||"0",10),hits:parseInt(u.stats?.find(p=>p.name==="H")?.value||"0",10),rbi:parseInt(u.stats?.find(p=>p.name==="RBI")?.value||"0",10),walks:parseInt(u.stats?.find(p=>p.name==="BB")?.value||"0",10),strikeouts:parseInt(u.stats?.find(p=>p.name==="K")?.value||"0",10),avg:h(parseInt(u.stats?.find(p=>p.name==="H")?.value||"0",10),parseInt(u.stats?.find(p=>p.name==="AB")?.value||"0",10))})):[],m=b=>b&&Array.isArray(b)?b.map(u=>({name:u.athlete?.displayName||"Unknown",decision:u.stats?.find(p=>p.name==="W"||p.name==="L"||p.name==="SV")?.abbreviation||"",inningsPitched:parseFloat(u.stats?.find(p=>p.name==="IP")?.value||"0"),hits:parseInt(u.stats?.find(p=>p.name==="H")?.value||"0",10),runs:parseInt(u.stats?.find(p=>p.name==="R")?.value||"0",10),earnedRuns:parseInt(u.stats?.find(p=>p.name==="ER")?.value||"0",10),walks:parseInt(u.stats?.find(p=>p.name==="BB")?.value||"0",10),strikeouts:parseInt(u.stats?.find(p=>p.name==="K")?.value||"0",10),era:S(parseInt(u.stats?.find(p=>p.name==="ER")?.value||"0",10),parseFloat(u.stats?.find(p=>p.name==="IP")?.value||"0"))})):[],f=b=>({runs:parseInt(b?.statistics?.find(u=>u.name==="runs")?.displayValue||"0",10),hits:parseInt(b?.statistics?.find(u=>u.name==="hits")?.displayValue||"0",10),errors:parseInt(b?.statistics?.find(u=>u.name==="errors")?.displayValue||"0",10),leftOnBase:parseInt(b?.statistics?.find(u=>u.name==="leftOnBase")?.displayValue||"0",10)});return{gameId:g.id,status:{type:g.competitions?.[0]?.status?.type?.name||"scheduled",detail:g.competitions?.[0]?.status?.type?.detail||"",completed:g.competitions?.[0]?.status?.type?.completed||!1,inning:g.competitions?.[0]?.status?.period||0,inningHalf:g.competitions?.[0]?.status?.type?.shortDetail?.includes("Top")?"top":"bottom"},teams:{home:{id:n?.team?.id||"",name:n?.team?.displayName||"",abbreviation:n?.team?.abbreviation||"",logo:n?.team?.logo||"",score:parseInt(n?.score||"0",10),record:n?.team?.record||"0-0",conference:n?.team?.conferenceId||""},away:{id:l?.team?.id||"",name:l?.team?.displayName||"",abbreviation:l?.team?.abbreviation||"",logo:l?.team?.logo||"",score:parseInt(l?.score||"0",10),record:l?.team?.record||"0-0",conference:l?.team?.conferenceId||""}},batting:{home:c(n?.statistics?.batting||[]),away:c(l?.statistics?.batting||[])},pitching:{home:m(n?.statistics?.pitching||[]),away:m(l?.statistics?.pitching||[])},teamStats:{home:f(n),away:f(l)},venue:{name:g.competitions?.[0]?.venue?.fullName||"",city:g.competitions?.[0]?.venue?.address?.city||"",state:g.competitions?.[0]?.venue?.address?.state||""},dataSource:"ESPN College Baseball API",lastUpdated:new Date().toISOString(),timezone:"America/Chicago"}}async fetchWithTimeout(w,g){let o=new AbortController,n=setTimeout(()=>o.abort(),this.config.timeout);try{let l=await fetch(w,{...g,signal:o.signal});if(!l.ok)throw Error(`NCAA API error: ${l.status} ${l.statusText}`);return l}catch(l){throw l instanceof Error&&l.name==="AbortError"?Error(`NCAA API request timeout after ${this.config.timeout}ms`):l}finally{clearTimeout(n)}}}A.NCAAAdapter=C},L.__chunk_8184=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.NBAAdapter=void 0;let E=C(6164);class w{constructor(o){this.baseUrl="https://api.sportsdata.io/v3/nba",this.apiKey=(0,E.validateApiKey)(o||"6ca2adb39404482da5406f0a6cd7aa37","SportsDataIO (NBA)")}getCurrentSeason(){let o=new Date,n=o.getMonth();return n>=6&&n<9||n>=9?o.getFullYear().toString():(o.getFullYear()-1).toString()}async getTeams(){return(0,E.retryWithBackoff)(async()=>{let o=await fetch(`${this.baseUrl}/scores/json/Teams`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}});if(!o.ok)throw Error(`NBA API error: ${o.statusText}`);return{data:(await o.json()).map(n=>({id:n.TeamID.toString(),name:n.Name,abbreviation:n.Key,city:n.City,logo:n.WikipediaLogoUrl,conference:n.Conference,division:n.Division})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getStandings(o){return(0,E.retryWithBackoff)(async()=>{let n=o??this.getCurrentSeason(),l=await fetch(`${this.baseUrl}/scores/json/Standings/${n}`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}});if(!l.ok)throw Error(`NBA API error: ${l.statusText}`);return{data:(await l.json()).map(h=>({team:{id:h.TeamID.toString(),name:h.Name,abbreviation:h.Key,city:h.City,conference:h.Conference,division:h.Division},wins:h.Wins,losses:h.Losses,winPercentage:h.Percentage,gamesBack:h.ConferenceRank>1?parseFloat(h.GamesBack||"0"):0,streak:h.Streak})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getGames(o){return(0,E.retryWithBackoff)(async()=>{let n=o||new Date().toISOString().split("T")[0],l=await fetch(`${this.baseUrl}/scores/json/GamesByDate/${n}`,{headers:{"Ocp-Apim-Subscription-Key":this.apiKey}});if(!l.ok)throw Error(`NBA API error: ${l.statusText}`);return{data:(await l.json()).map(h=>({id:h.GameID.toString(),sport:"NBA",date:h.DateTime,status:this.mapGameStatus(h.Status),homeTeam:{id:h.HomeTeamID?.toString()||"",name:h.HomeTeam,abbreviation:h.HomeTeam,city:""},awayTeam:{id:h.AwayTeamID?.toString()||"",name:h.AwayTeam,abbreviation:h.AwayTeam,city:""},homeScore:h.HomeTeamScore||0,awayScore:h.AwayTeamScore||0,period:h.Quarter?`Q${h.Quarter}`:void 0,venue:h.StadiumDetails?.Name})),source:{provider:"SportsDataIO",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}mapGameStatus(o){switch(o){case"Final":case"F/OT":return"final";case"InProgress":case"Halftime":return"live";case"Scheduled":default:return"scheduled";case"Postponed":return"postponed";case"Canceled":return"cancelled"}}}A.NBAAdapter=w},L.__chunk_190=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.MLBAdapter=void 0;let E=C(6164);class w{constructor(){this.baseUrl="https://statsapi.mlb.com/api/v1",this.sportsDataIOKey=(0,E.validateApiKey)("6ca2adb39404482da5406f0a6cd7aa37","SportsDataIO"),this.apiKey=""}getCurrentSeason(){let o=new Date;return o.getMonth()>=10?o.getFullYear()+1:o.getFullYear()}async getTeams(){return(0,E.retryWithBackoff)(async()=>{let o=await(0,E.fetchWithTimeout)(`${this.baseUrl}/teams?sportId=1`,{},1e4);if(!o.ok)throw Error(`MLB API error: ${o.statusText}`);return{data:(await o.json()).teams.map(n=>({id:n.id.toString(),name:n.name,abbreviation:n.abbreviation,city:n.locationName,logo:`https://www.mlbstatic.com/team-logos/${n.id}.svg`,division:n.division?.name,conference:n.league?.name})),source:{provider:"MLB Stats API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getStandings(o){return(0,E.retryWithBackoff)(async()=>{let n=this.getCurrentSeason(),l=o?`${this.baseUrl}/standings?leagueId=103,104&season=${n}&standingsTypes=regularSeason&divisionId=${o}`:`${this.baseUrl}/standings?leagueId=103,104&season=${n}&standingsTypes=regularSeason`,h=await(0,E.fetchWithTimeout)(l,{},1e4);if(!h.ok)throw Error(`MLB API error: ${h.statusText}`);let S=await h.json(),c=[];return S.records?.forEach(m=>{m.teamRecords?.forEach(f=>{c.push({team:{id:f.team.id.toString(),name:f.team.name,abbreviation:f.team.abbreviation||"",city:f.team.locationName||""},wins:f.wins,losses:f.losses,winPercentage:parseFloat(f.winningPercentage),gamesBack:parseFloat(f.gamesBack)||0,streak:f.streak?.streakCode,lastTen:f.records?.splitRecords?.find(b=>b.type==="lastTen")?.record})})}),{data:c,source:{provider:"MLB Stats API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}async getGames(o){return(0,E.retryWithBackoff)(async()=>{let n=o||new Date().toISOString().split("T")[0],l=`${this.baseUrl}/schedule?sportId=1&date=${n}`,h=await(0,E.fetchWithTimeout)(l,{},1e4);if(!h.ok)throw Error(`MLB API error: ${h.statusText}`);return{data:(await h.json()).dates?.[0]?.games?.map(c=>({id:c.gamePk.toString(),sport:"MLB",date:c.gameDate,status:this.mapGameStatus(c.status.statusCode),homeTeam:{id:c.teams.home.team.id.toString(),name:c.teams.home.team.name,abbreviation:c.teams.home.team.abbreviation,city:c.teams.home.team.locationName||""},awayTeam:{id:c.teams.away.team.id.toString(),name:c.teams.away.team.name,abbreviation:c.teams.away.team.abbreviation,city:c.teams.away.team.locationName||""},homeScore:c.teams.home.score||0,awayScore:c.teams.away.score||0,period:c.linescore?.currentInning?`${c.linescore.currentInning}${c.linescore.inningHalf}`:void 0,venue:c.venue?.name,broadcasters:c.broadcasts?.map(m=>m.name).filter(Boolean)||void 0,probablePitchers:this.mapProbablePitchers(c.probablePitchers),linescore:this.mapLinescore(c.linescore,c.teams)}))||[],source:{provider:"MLB Stats API",timestamp:(0,E.getChicagoTimestamp)(),confidence:1}}})}mapGameStatus(o){switch(o){case"F":case"FT":case"FR":return"final";case"I":case"IR":case"IA":return"live";case"P":case"S":case"PR":default:return"scheduled";case"PP":case"PO":return"postponed";case"C":return"cancelled"}}mapProbablePitchers(o){if(!o?.home&&!o?.away)return;let n=this.toPitcherInfo(o.home),l=this.toPitcherInfo(o.away);if(n||l)return{home:n,away:l}}toPitcherInfo(o){if(!o)return;let n=[o.firstName,o.lastName].filter(Boolean).join(" ").trim();if(!n)return;let l=o.stats?.pitching||o.seasonStats?.pitching,h=S=>{if(S==null)return;let c=typeof S=="string"?parseFloat(S):Number(S);return Number.isFinite(c)?c:void 0};return{name:n,throws:o.pitchHand?.description||o.pitchHand?.code,wins:h(l?.wins),losses:h(l?.losses),era:h(l?.era)}}mapLinescore(o,n){if(!o)return;let l=Array.isArray(o.innings)?o.innings.map(S=>({number:S.num,home:S.home?.runs??null,away:S.away?.runs??null})):[],h={home:{runs:o.teams?.home?.runs??n?.home?.score??0,hits:o.teams?.home?.hits??0,errors:o.teams?.home?.errors??0},away:{runs:o.teams?.away?.runs??n?.away?.score??0,hits:o.teams?.away?.hits??0,errors:o.teams?.away?.errors??0}};return{currentInning:o.currentInning??void 0,inningState:o.inningState||o.inningHalf||void 0,innings:l,totals:h}}}A.MLBAdapter=w},L.__chunk_320=($,A)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.D1BaseballAdapter=void 0,A.createD1BaseballAdapter=function(E){return new C(E)};class C{constructor(w={}){this.config={apiKey:w.apiKey||"",baseURL:w.baseURL||"https://d1baseball.com/api",timeout:w.timeout||1e4},this.headers={"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}}}async getRankings(w){let g=new URLSearchParams;w&&g.append("week",w);let o=`${this.config.baseURL}/rankings${g.toString()?`?${g}`:""}`,n=await this.fetchWithTimeout(o,{headers:this.headers}),l=await n.json();return this.transformRankings(l)}async getConferenceStandings(w){let g=`${this.config.baseURL}/standings/${encodeURIComponent(w)}`;try{let o=await this.fetchWithTimeout(g,{headers:this.headers}),n=await o.json();return this.transformStandings(w,n)}catch(o){return console.error(`Failed to fetch standings for ${w}:`,o),null}}async getAllConferenceStandings(){let w=["ACC","SEC","Big 12","Big Ten","Pac-12","American","Conference USA","MAC","Mountain West","Sun Belt","WAC","Big West","ASUN","Atlantic 10","Big East","Colonial","Horizon","Ivy League","MAAC","MEAC","Missouri Valley","Northeast","Ohio Valley","Patriot","Southern","Southland","SWAC","Summit","West Coast"].map(g=>this.getConferenceStandings(g));return(await Promise.allSettled(w)).filter(g=>g.status==="fulfilled"&&g.value!==null).map(g=>g.value)}transformRankings(w){return w.rankings&&Array.isArray(w.rankings)?w.rankings.map((g,o)=>{let n=g.previousRank||0,l=o+1,h="same";return n===0?h="new":l<n?h="up":l>n&&(h="down"),{rank:l,team:{id:g.teamId||g.id||`${g.school}-${l}`,school:g.school||g.name,conference:g.conference||"",logo:g.logo||""},record:{overall:g.record||"0-0",conference:g.conferenceRecord||"0-0",wins:parseInt(g.wins||"0",10),losses:parseInt(g.losses||"0",10)},previousRank:n,rankMovement:h,firstPlaceVotes:parseInt(g.firstPlaceVotes||"0",10),points:parseInt(g.points||"0",10)}}):[]}transformStandings(w,g){let o=[];return g.teams&&Array.isArray(g.teams)&&o.push(...g.teams.map(n=>({id:n.teamId||n.id||`${n.school}-${w}`,school:n.school||n.name,logo:n.logo||"",record:{overall:n.overallRecord||"0-0",conference:n.conferenceRecord||"0-0",wins:parseInt(n.wins||"0",10),losses:parseInt(n.losses||"0",10),conferenceWins:parseInt(n.conferenceWins||"0",10),conferenceLosses:parseInt(n.conferenceLosses||"0",10),winPercentage:parseFloat(n.winPercentage||"0"),conferenceWinPercentage:parseFloat(n.conferenceWinPercentage||"0")},stats:{runsScored:parseInt(n.runsScored||"0",10),runsAllowed:parseInt(n.runsAllowed||"0",10),homeRecord:n.homeRecord||"0-0",awayRecord:n.awayRecord||"0-0",streak:n.streak||""}}))),o.sort((n,l)=>l.record.conferenceWinPercentage!==n.record.conferenceWinPercentage?l.record.conferenceWinPercentage-n.record.conferenceWinPercentage:l.record.winPercentage-n.record.winPercentage),{conference:w,teams:o,lastUpdated:new Date().toISOString(),dataSource:"D1Baseball.com"}}async fetchWithTimeout(w,g){let o=new AbortController,n=setTimeout(()=>o.abort(),this.config.timeout);try{let l=await fetch(w,{...g,signal:o.signal});if(!l.ok)throw Error(`D1Baseball API error: ${l.status} ${l.statusText}`);return l}catch(l){throw l instanceof Error&&l.name==="AbortError"?Error(`D1Baseball API request timeout after ${this.config.timeout}ms`):l}finally{clearTimeout(n)}}}A.D1BaseballAdapter=C},L.__chunk_7399=($,A,C)=>{Object.defineProperty(A,"__esModule",{value:!0}),A.CollegeBaseballAdapter=void 0;let E=C(6164);class w{constructor(){this.espnBaseUrl="https://site.api.espn.com/apis/site/v2/sports/baseball/college-baseball",this.ncaaBaseUrl="https://stats.ncaa.org/rankings"}async getTeams(){return(0,E.retryWithBackoff)(async()=>{let o=`${this.espnBaseUrl}/teams`,n=await fetch(o,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!n.ok)throw Error(`ESPN API error: ${n.statusText}`);return{data:((await n.json()).sports?.[0]?.leagues?.[0]?.teams||[]).map(h=>({id:h.team?.id||"",name:h.team?.displayName||"",abbreviation:h.team?.abbreviation||"",city:h.team?.location||"",logo:h.team?.logos?.[0]?.href||"",conference:h.team?.groups?.[0]?.name})),source:{provider:"ESPN API",timestamp:(0,E.getChicagoTimestamp)(),confidence:.95}}})}async getGames(o){let n=o?.date;return this.getGamesWithBoxScores(n)}async getGamesWithBoxScores(o){return(0,E.retryWithBackoff)(async()=>{let n=o||new Date().toISOString().split("T")[0].replace(/-/g,""),l=`${this.espnBaseUrl}/scoreboard?dates=${n}`,h=await fetch(l,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!h.ok)throw Error(`ESPN API error: ${h.statusText}`);let S=await h.json();return{data:await Promise.all((S.events||[]).map(async c=>{let m=c.competitions?.[0]?.competitors?.find(u=>u.homeAway==="home"),f=c.competitions?.[0]?.competitors?.find(u=>u.homeAway==="away"),b={id:c.id,sport:"COLLEGE_BASEBALL",date:c.date,status:this.mapGameStatus(c.status?.type?.name),homeTeam:{id:m?.team?.id||"",name:m?.team?.displayName||"",abbreviation:m?.team?.abbreviation||"",city:m?.team?.location||"",logo:m?.team?.logo||""},awayTeam:{id:f?.team?.id||"",name:f?.team?.displayName||"",abbreviation:f?.team?.abbreviation||"",city:f?.team?.location||"",logo:f?.team?.logo||""},homeScore:parseInt(m?.score||"0"),awayScore:parseInt(f?.score||"0"),period:c.status?.period?`Inning ${c.status.period}`:void 0,venue:c.competitions?.[0]?.venue?.fullName};if(b.status==="final"||b.status==="live")try{let u=await this.getBoxScore(c.id);b.boxScore=u}catch(u){console.error(`Failed to fetch box score for game ${c.id}:`,u)}return b})),source:{provider:"ESPN API + Blaze Box Score Enhancement",timestamp:(0,E.getChicagoTimestamp)(),confidence:.95}}})}async getBoxScore(o){let n=`${this.espnBaseUrl}/summary?event=${o}`,l=await fetch(n,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!l.ok)throw Error(`ESPN box score error: ${l.statusText}`);let h=await l.json(),S=[],c=[];return h.boxscore?.players?.forEach(m=>{m.statistics?.forEach(f=>{f.name==="Batting"&&f.athletes?.forEach(b=>{let u=b.stats||[],p=parseInt(u[0]||"0"),I=parseInt(u[2]||"0");S.push({name:b.athlete?.displayName||"Unknown",position:b.athlete?.position?.abbreviation||"",atBats:p,runs:parseInt(u[1]||"0"),hits:I,rbi:parseInt(u[3]||"0"),walks:parseInt(u[4]||"0"),strikeouts:parseInt(u[5]||"0"),avg:p>0?(I/p).toFixed(3):".000"})}),f.name==="Pitching"&&f.athletes?.forEach(b=>{let u=b.stats||[],p=parseFloat(u[0]||"0"),I=parseInt(u[3]||"0");c.push({name:b.athlete?.displayName||"Unknown",decision:b.athlete?.displayValue||"",inningsPitched:p,hits:parseInt(u[1]||"0"),runs:parseInt(u[2]||"0"),earnedRuns:I,walks:parseInt(u[4]||"0"),strikeouts:parseInt(u[5]||"0"),era:p>0?(9*I/p).toFixed(2):"0.00"})})})}),{battingLines:S,pitchingLines:c}}async getStandings(o){return(0,E.retryWithBackoff)(async()=>{let n=o?`${this.espnBaseUrl}/standings?group=${o}`:`${this.espnBaseUrl}/standings`,l=await fetch(n,{headers:{"User-Agent":"BlazeSportsIntel/1.0",Accept:"application/json"}});if(!l.ok)throw Error(`ESPN API error: ${l.statusText}`);return{data:((await l.json()).standings||[]).flatMap(h=>(h.standings?.entries||[]).map(S=>{let c=S.stats||[],m=c.find(u=>u.name==="wins")?.value||0,f=c.find(u=>u.name==="losses")?.value||0,b=m+f;return{team:{id:S.team?.id||"",name:S.team?.displayName||"",abbreviation:S.team?.abbreviation||"",city:S.team?.location||"",logo:S.team?.logos?.[0]?.href||"",conference:h.name},wins:m,losses:f,winPercentage:b>0?m/b:0,gamesBack:c.find(u=>u.name==="gamesBehind")?.value||0,streak:c.find(u=>u.name==="streak")?.displayValue,lastTen:c.find(u=>u.name==="L10")?.displayValue}})),source:{provider:"ESPN API",timestamp:(0,E.getChicagoTimestamp)(),confidence:.9}}})}mapGameStatus(o){switch(o?.toLowerCase()){case"status.type.final":return"final";case"status.type.inprogress":return"live";case"status.type.scheduled":case"status.type.pre":default:return"scheduled";case"status.type.postponed":return"postponed";case"status.type.canceled":return"cancelled"}}}A.CollegeBaseballAdapter=w},L.__chunk_5540=($,A,C)=>{"use strict";let E,w;C.r(A),C.d(A,{CompactEncrypt:()=>bt,CompactSign:()=>Et,EmbeddedJWK:()=>Sa,EncryptJWT:()=>wa,FlattenedEncrypt:()=>Ae,FlattenedSign:()=>$e,GeneralEncrypt:()=>oa,GeneralSign:()=>fa,SignJWT:()=>ga,UnsecuredJWT:()=>ka,base64url:()=>g,calculateJwkThumbprint:()=>vt,calculateJwkThumbprintUri:()=>Aa,compactDecrypt:()=>yt,compactVerify:()=>At,createLocalJWKSet:()=>Me,createRemoteJWKSet:()=>Pa,cryptoRuntime:()=>Ha,customFetch:()=>Pt,decodeJwt:()=>Ta,decodeProtectedHeader:()=>Ka,errors:()=>o,exportJWK:()=>Re,exportPKCS8:()=>ia,exportSPKI:()=>sa,flattenedDecrypt:()=>De,flattenedVerify:()=>Je,generalDecrypt:()=>aa,generalVerify:()=>la,generateKeyPair:()=>Ia,generateSecret:()=>Wa,importJWK:()=>ge,importPKCS8:()=>jt,importSPKI:()=>Mt,importX509:()=>xt,jwksCache:()=>Se,jwtDecrypt:()=>pa,jwtVerify:()=>ua});var g={};C.r(g),C.d(g,{decode:()=>p,encode:()=>I});var o={};C.r(o),C.d(o,{JOSEAlgNotAllowed:()=>he,JOSEError:()=>W,JOSENotSupported:()=>H,JWEDecryptionFailed:()=>ie,JWEInvalid:()=>v,JWKInvalid:()=>je,JWKSInvalid:()=>Ee,JWKSMultipleMatchingKeys:()=>Fe,JWKSNoMatchingKey:()=>ve,JWKSTimeout:()=>Ge,JWSInvalid:()=>O,JWSSignatureVerificationFailed:()=>Ce,JWTClaimValidationFailed:()=>B,JWTExpired:()=>ee,JWTInvalid:()=>M});let n=new TextEncoder,l=new TextDecoder;function h(...e){let t=new Uint8Array(e.reduce((r,{length:s})=>r+s,0)),a=0;for(let r of e)t.set(r,a),a+=r.length;return t}function S(e,t,a){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967295}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],a)}function c(e){let t=new Uint8Array(8);return S(t,Math.floor(e/4294967296),0),S(t,e%4294967296,4),t}function m(e){let t=new Uint8Array(4);return S(t,e),t}function f(e){let t=new Uint8Array(e.length);for(let a=0;a<e.length;a++){let r=e.charCodeAt(a);if(r>127)throw TypeError("non-ASCII string encountered in encode()");t[a]=r}return t}function b(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let a=0;a<e.length;a+=32768)t.push(String.fromCharCode.apply(null,e.subarray(a,a+32768)));return btoa(t.join(""))}function u(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),a=new Uint8Array(t.length);for(let r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return a}function p(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof e=="string"?e:l.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=l.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return u(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function I(e){let t=e;return typeof t=="string"&&(t=n.encode(t)),Uint8Array.prototype.toBase64?t.toBase64({alphabet:"base64url",omitPadding:!0}):b(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class W extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(t,a){super(t,a),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class B extends W{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(t,a,r="unspecified",s="unspecified"){super(t,{cause:{claim:r,reason:s,payload:a}}),this.claim=r,this.reason=s,this.payload=a}}class ee extends W{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(t,a,r="unspecified",s="unspecified"){super(t,{cause:{claim:r,reason:s,payload:a}}),this.claim=r,this.reason=s,this.payload=a}}class he extends W{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class H extends W{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class ie extends W{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(t="decryption operation failed",a){super(t,a)}}class v extends W{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class O extends W{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class M extends W{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class je extends W{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class Ee extends W{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class ve extends W{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(t="no applicable key found in the JSON Web Key Set",a){super(t,a)}}class Fe extends W{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(t="multiple matching keys found in the JSON Web Key Set",a){super(t,a)}}class Ge extends W{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(t="request timed out",a){super(t,a)}}class Ce extends W{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(t="signature verification failed",a){super(t,a)}}function Ve(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new H(`Unsupported JWE Algorithm: ${e}`)}}let kt=e=>crypto.getRandomValues(new Uint8Array(Ve(e)>>3));function ze(e,t){if(t.length<<3!==Ve(e))throw new v("Invalid Initialization Vector length")}function ue(e,t){let a=e.byteLength<<3;if(a!==t)throw new v(`Invalid Content Encryption Key length. Expected ${t} bits, got ${a} bits`)}let R=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),F=(e,t)=>e.name===t;function pe(e){return parseInt(e.name.slice(4),10)}function Ye(e,t){if(t&&!e.usages.includes(t))throw TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function z(e,t,a){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!F(e.algorithm,"AES-GCM"))throw R("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw R(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!F(e.algorithm,"AES-KW"))throw R("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw R(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw R("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!F(e.algorithm,"PBKDF2"))throw R("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!F(e.algorithm,"RSA-OAEP"))throw R("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(pe(e.algorithm.hash)!==r)throw R(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}Ye(e,a)}function Xe(e,t,...a){if((a=a.filter(Boolean)).length>2){let r=a.pop();e+=`one of type ${a.join(", ")}, or ${r}.`}else a.length===2?e+=`one of type ${a[0]} or ${a[1]}.`:e+=`of type ${a[0]}.`;return t==null?e+=` Received ${t}`:typeof t=="function"&&t.name?e+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let Y=(e,...t)=>Xe("Key must be ",e,...t),qe=(e,t,...a)=>Xe(`Key for the ${e} algorithm must be `,t,...a);function ne(e){if(!q(e))throw Error("CryptoKey instance expected")}let q=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},ye=e=>e?.[Symbol.toStringTag]==="KeyObject",Pe=e=>q(e)||ye(e);async function Kt(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let a={name:"HMAC",hash:"SHA-256"},r=await crypto.subtle.generateKey(a,!1,["sign"]),s=new Uint8Array(await crypto.subtle.sign(a,r,e)),i=new Uint8Array(await crypto.subtle.sign(a,r,t)),d=0,y=-1;for(;++y<32;)d|=s[y]^i[y];return d===0}async function Tt(e,t,a,r,s,i){let d,y;if(!(t instanceof Uint8Array))throw TypeError(Y(t,"Uint8Array"));let K=parseInt(e.slice(1,4),10),k=await crypto.subtle.importKey("raw",t.subarray(K>>3),"AES-CBC",!1,["decrypt"]),P=await crypto.subtle.importKey("raw",t.subarray(0,K>>3),{hash:`SHA-${K<<1}`,name:"HMAC"},!1,["sign"]),T=h(i,r,a,c(i.length<<3)),J=new Uint8Array((await crypto.subtle.sign("HMAC",P,T)).slice(0,K>>3));try{d=await Kt(s,J)}catch{}if(!d)throw new ie;try{y=new Uint8Array(await crypto.subtle.decrypt({iv:r,name:"AES-CBC"},k,a))}catch{}if(!y)throw new ie;return y}async function It(e,t,a,r,s,i){let d;t instanceof Uint8Array?d=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(z(t,e,"decrypt"),d=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:i,iv:r,name:"AES-GCM",tagLength:128},d,h(a,s)))}catch{throw new ie}}async function Qe(e,t,a,r,s,i){if(!q(t)&&!(t instanceof Uint8Array))throw TypeError(Y(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!r)throw new v("JWE Initialization Vector missing");if(!s)throw new v("JWE Authentication Tag missing");switch(ze(e,r),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&ue(t,parseInt(e.slice(-3),10)),Tt(e,t,a,r,s,i);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&ue(t,parseInt(e.slice(1,4),10)),It(e,t,a,r,s,i);default:throw new H("Unsupported JWE Content Encryption Algorithm")}}function oe(...e){let t,a=e.filter(Boolean);if(a.length===0||a.length===1)return!0;for(let r of a){let s=Object.keys(r);if(!t||t.size===0){t=new Set(s);continue}for(let i of s){if(t.has(i))return!1;t.add(i)}}return!0}let Wt=e=>typeof e=="object"&&e!==null;function U(e){if(!Wt(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Ze(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function et(e,t,a){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[a]):(z(e,t,a),e)}async function ke(e,t,a){let r=await et(t,e,"wrapKey");Ze(r,e);let s=await crypto.subtle.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",s,r,"AES-KW"))}async function Ke(e,t,a){let r=await et(t,e,"unwrapKey");Ze(r,e);let s=await crypto.subtle.unwrapKey("raw",a,r,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",s))}async function tt(e,t){let a=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(a,t))}function Te(e){return h(m(e.length),e)}async function Ht(e,t,a){let r=t>>3,s=Math.ceil(r/32),i=new Uint8Array(32*s);for(let d=1;d<=s;d++){let y=new Uint8Array(4+e.length+a.length);y.set(m(d),0),y.set(e,4),y.set(a,4+e.length);let K=await tt("sha256",y);i.set(K,(d-1)*32)}return i.slice(0,r)}async function at(e,t,a,r,s=new Uint8Array,i=new Uint8Array){z(e,"ECDH"),z(t,"ECDH","deriveBits");let d=Te(f(a)),y=Te(s),K=h(d,y,Te(i),m(r),new Uint8Array);return Ht(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,e.algorithm.name==="X25519"?256:Math.ceil(parseInt(e.algorithm.namedCurve.slice(-3),10)/8)<<3)),r,K)}function rt(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return e.algorithm.name==="X25519"}}let Ot=(e,t)=>h(f(e),Uint8Array.of(0),t);async function st(e,t,a,r){if(!(e instanceof Uint8Array)||e.length<8)throw new v("PBES2 Salt Input must be 8 or more octets");let s=Ot(t,e),i=parseInt(t.slice(13,16),10),d={hash:`SHA-${t.slice(8,11)}`,iterations:a,name:"PBKDF2",salt:s},y=await(r instanceof Uint8Array?crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]):(z(r,t,"deriveBits"),r));return new Uint8Array(await crypto.subtle.deriveBits(d,y,i))}async function Bt(e,t,a,r=2048,s=crypto.getRandomValues(new Uint8Array(16))){let i=await st(s,e,r,t);return{encryptedKey:await ke(e.slice(-6),i,a),p2c:r,p2s:I(s)}}async function Ut(e,t,a,r,s){let i=await st(s,e,r,t);return Ke(e.slice(-6),i,a)}function me(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:a}=t.algorithm;if(typeof a!="number"||a<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}let it=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new H(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function _t(e,t,a){return z(t,e,"encrypt"),me(e,t),new Uint8Array(await crypto.subtle.encrypt(it(e),t,a))}async function Dt(e,t,a){return z(t,e,"decrypt"),me(e,t),new Uint8Array(await crypto.subtle.decrypt(it(e),t,a))}function Ie(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new H(`Unsupported JWE Algorithm: ${e}`)}}let Q=e=>crypto.getRandomValues(new Uint8Array(Ie(e)>>3)),nt=(e,t)=>{let a=(e.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${t}-----
${a}
-----END ${t}-----`},ot=async(e,t,a)=>{if(ye(a)){if(a.type!==e)throw TypeError(`key is not a ${e} key`);return a.export({format:"pem",type:t})}if(!q(a))throw TypeError(Y(a,"CryptoKey","KeyObject"));if(!a.extractable)throw TypeError("CryptoKey is not extractable");if(a.type!==e)throw TypeError(`key is not a ${e} key`);return nt(b(new Uint8Array(await crypto.subtle.exportKey(t,a))),`${e.toUpperCase()} KEY`)},Rt=e=>ot("public","spki",e),Jt=e=>ot("private","pkcs8",e),We=(e,t)=>{if(e.byteLength!==t.length)return!1;for(let a=0;a<e.byteLength;a++)if(e[a]!==t[a])return!1;return!0},He=e=>({data:e,pos:0}),j=e=>{let t=e.data[e.pos++];if(128&t){let a=127&t,r=0;for(let s=0;s<a;s++)r=r<<8|e.data[e.pos++];return r}return t},Oe=(e,t=1)=>{if(t<=0)return;e.pos++;let a=j(e);e.pos+=a,t>1&&Oe(e,t-1)},G=(e,t,a)=>{if(e.data[e.pos++]!==t)throw Error(a)},ct=(e,t)=>{let a=e.data.subarray(e.pos,e.pos+t);return e.pos+=t,a},Nt=e=>{G(e,6,"Expected algorithm OID");let t=j(e);return ct(e,t)},lt=e=>{let t=Nt(e);if(We(t,[43,101,110]))return"X25519";if(!We(t,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");G(e,6,"Expected curve OID");let a=j(e),r=ct(e,a);for(let{name:s,oid:i}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(We(r,i))return s;throw Error("Unsupported named curve")},dt=async(e,t,a,r)=>{let s,i,d=e==="spki",y=()=>d?["verify"]:["sign"];switch(a){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${a.slice(-3)}`},i=y();break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.slice(-3)}`},i=y();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(a.slice(-3),10)||1}`},i=d?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":s={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[a]},i=y();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let K=r.getNamedCurve(t);s=K==="X25519"?{name:"X25519"}:{name:"ECDH",namedCurve:K}}catch{throw new H("Invalid or unsupported key format")}i=d?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":s={name:"Ed25519"},i=y();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":s={name:a},i=y();break;default:throw new H('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,t,s,r?.extractable??!!d,i)},Be=(e,t)=>u(e.replace(t,"")),Lt=(e,t,a)=>{let r=Be(e,/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g),s=a;return t?.startsWith?.("ECDH-ES")&&((s||={}).getNamedCurve=i=>{let d=He(i);return function(y){G(y,48,"Invalid PKCS#8 structure"),j(y),G(y,2,"Expected version field");let K=j(y);y.pos+=K,G(y,48,"Expected algorithm identifier"),j(y),y.pos}(d),lt(d)}),dt("pkcs8",r,t,s)},ht=(e,t,a)=>{let r=Be(e,/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g),s=a;return t?.startsWith?.("ECDH-ES")&&((s||={}).getNamedCurve=i=>{let d=He(i);return function(y){G(y,48,"Invalid SPKI structure"),j(y),G(y,48,"Expected algorithm identifier"),j(y),y.pos}(d),lt(d)}),dt("spki",r,t,s)},$t=(e,t,a)=>{let r;try{r=function(s){let i=He(s);G(i,48,"Invalid certificate structure"),j(i),G(i,48,"Invalid tbsCertificate structure"),j(i),s[i.pos]===160?Oe(i,6):Oe(i,5);let d=i.pos;G(i,48,"Invalid SPKI structure");let y=j(i);return s.subarray(d,d+y+(i.pos-d))}(Be(e,/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g))}catch(s){throw TypeError("Failed to parse the X.509 certificate",{cause:s})}return ht(nt(b(r),"PUBLIC KEY"),t,a)};async function fe(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:a}=function(s){let i,d;switch(s.kty){case"AKP":switch(s.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:s.alg},d=s.priv?["sign"]:["verify"];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(s.alg){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${s.alg.slice(-3)}`},d=s.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${s.alg.slice(-3)}`},d=s.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(s.alg.slice(-3),10)||1}`},d=s.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(s.alg){case"ES256":i={name:"ECDSA",namedCurve:"P-256"},d=s.d?["sign"]:["verify"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},d=s.d?["sign"]:["verify"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},d=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:"ECDH",namedCurve:s.crv},d=s.d?["deriveBits"]:[];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(s.alg){case"Ed25519":case"EdDSA":i={name:"Ed25519"},d=s.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":i={name:s.crv},d=s.d?["deriveBits"]:[];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new H('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:i,keyUsages:d}}(e),r={...e};return r.kty!=="AKP"&&delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,t,e.ext??(!e.d&&!e.priv),e.key_ops??a)}async function Mt(e,t,a){if(typeof e!="string"||e.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw TypeError('"spki" must be SPKI formatted string');return ht(e,t,a)}async function xt(e,t,a){if(typeof e!="string"||e.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw TypeError('"x509" must be X.509 formatted string');return $t(e,t,a)}async function jt(e,t,a){if(typeof e!="string"||e.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw TypeError('"pkcs8" must be PKCS#8 formatted string');return Lt(e,t,a)}async function ge(e,t,a){let r;if(!U(e))throw TypeError("JWK must be an object");switch(t??=e.alg,r??=a?.extractable??e.ext,e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return p(e.k);case"RSA":if("oth"in e&&e.oth!==void 0)throw new H('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return fe({...e,alg:t,ext:r});case"AKP":if(typeof e.alg!="string"||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(t!==void 0&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return fe({...e,ext:r});case"EC":case"OKP":return fe({...e,alg:t,ext:r});default:throw new H('Unsupported "kty" (Key Type) Parameter value')}}async function Ft(e,t,a,r,s){if(!(a instanceof Uint8Array))throw TypeError(Y(a,"Uint8Array"));let i=parseInt(e.slice(1,4),10),d=await crypto.subtle.importKey("raw",a.subarray(i>>3),"AES-CBC",!1,["encrypt"]),y=await crypto.subtle.importKey("raw",a.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),K=new Uint8Array(await crypto.subtle.encrypt({iv:r,name:"AES-CBC"},d,t)),k=h(s,r,K,c(s.length<<3));return{ciphertext:K,tag:new Uint8Array((await crypto.subtle.sign("HMAC",y,k)).slice(0,i>>3)),iv:r}}async function Gt(e,t,a,r,s){let i;a instanceof Uint8Array?i=await crypto.subtle.importKey("raw",a,"AES-GCM",!1,["encrypt"]):(z(a,e,"encrypt"),i=a);let d=new Uint8Array(await crypto.subtle.encrypt({additionalData:s,iv:r,name:"AES-GCM",tagLength:128},i,t)),y=d.slice(-16);return{ciphertext:d.slice(0,-16),tag:y,iv:r}}async function ut(e,t,a,r,s){if(!q(a)&&!(a instanceof Uint8Array))throw TypeError(Y(a,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));switch(r?ze(e,r):r=kt(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return a instanceof Uint8Array&&ue(a,parseInt(e.slice(-3),10)),Ft(e,t,a,r,s);case"A128GCM":case"A192GCM":case"A256GCM":return a instanceof Uint8Array&&ue(a,parseInt(e.slice(1,4),10)),Gt(e,t,a,r,s);default:throw new H("Unsupported JWE Content Encryption Algorithm")}}async function Vt(e,t,a,r){let s=e.slice(0,7),i=await ut(s,a,t,r,new Uint8Array);return{encryptedKey:i.ciphertext,iv:I(i.iv),tag:I(i.tag)}}async function zt(e,t,a,r,s){return Qe(e.slice(0,7),t,a,r,s,new Uint8Array)}async function Yt(e,t,a,r,s){switch(e){case"dir":if(a!==void 0)throw new v("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(a!==void 0)throw new v("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i,d;if(!U(r.epk))throw new v('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(ne(t),!rt(t))throw new H("ECDH with the provided key is not allowed or not supported by your javascript runtime");let y=await ge(r.epk,e);if(ne(y),r.apu!==void 0){if(typeof r.apu!="string")throw new v('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=p(r.apu)}catch{throw new v("Failed to base64url decode the apu")}}if(r.apv!==void 0){if(typeof r.apv!="string")throw new v('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{d=p(r.apv)}catch{throw new v("Failed to base64url decode the apv")}}let K=await at(y,t,e==="ECDH-ES"?r.enc:e,e==="ECDH-ES"?Ie(r.enc):parseInt(e.slice(-5,-2),10),i,d);if(e==="ECDH-ES")return K;if(a===void 0)throw new v("JWE Encrypted Key missing");return Ke(e.slice(-6),K,a)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(a===void 0)throw new v("JWE Encrypted Key missing");return ne(t),Dt(e,t,a);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let i;if(a===void 0)throw new v("JWE Encrypted Key missing");if(typeof r.p2c!="number")throw new v('JOSE Header "p2c" (PBES2 Count) missing or invalid');let d=s?.maxPBES2Count||1e4;if(r.p2c>d)throw new v('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof r.p2s!="string")throw new v('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{i=p(r.p2s)}catch{throw new v("Failed to base64url decode the p2s")}return Ut(e,t,a,r.p2c,i)}case"A128KW":case"A192KW":case"A256KW":if(a===void 0)throw new v("JWE Encrypted Key missing");return Ke(e,t,a);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let i,d;if(a===void 0)throw new v("JWE Encrypted Key missing");if(typeof r.iv!="string")throw new v('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof r.tag!="string")throw new v('JOSE Header "tag" (Authentication Tag) missing or invalid');try{i=p(r.iv)}catch{throw new v("Failed to base64url decode the iv")}try{d=p(r.tag)}catch{throw new v("Failed to base64url decode the tag")}return zt(e,t,a,i,d)}default:throw new H('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function ce(e,t,a,r,s){let i;if(s.crit!==void 0&&r?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(d=>typeof d!="string"||d.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let d of(i=a!==void 0?new Map([...Object.entries(a),...t.entries()]):t,r.crit)){if(!i.has(d))throw new H(`Extension Header Parameter "${d}" is not recognized`);if(s[d]===void 0)throw new e(`Extension Header Parameter "${d}" is missing`);if(i.get(d)&&r[d]===void 0)throw new e(`Extension Header Parameter "${d}" MUST be integrity protected`)}return new Set(r.crit)}function Ue(e,t){if(t!==void 0&&(!Array.isArray(t)||t.some(a=>typeof a!="string")))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}let we=e=>U(e)&&typeof e.kty=="string",Xt=e=>e.kty!=="oct"&&(e.kty==="AKP"&&typeof e.priv=="string"||typeof e.d=="string"),qt=e=>e.kty!=="oct"&&e.d===void 0&&e.priv===void 0,Qt=e=>e.kty==="oct"&&typeof e.k=="string",pt=async(e,t,a,r=!1)=>{let s=(E||=new WeakMap).get(e);if(s?.[a])return s[a];let i=await fe({...t,alg:a});return r&&Object.freeze(e),s?s[a]=i:E.set(e,{[a]:i}),i},Zt=(e,t)=>{let a,r=(E||=new WeakMap).get(e);if(r?.[t])return r[t];let s=e.type==="public",i=!!s;if(e.asymmetricKeyType==="x25519"){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}a=e.toCryptoKey(e.asymmetricKeyType,i,s?[]:["deriveBits"])}if(e.asymmetricKeyType==="ed25519"){if(t!=="EdDSA"&&t!=="Ed25519")throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,i,[s?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");a=e.toCryptoKey(e.asymmetricKeyType,i,[s?"verify":"sign"])}if(e.asymmetricKeyType==="rsa"){let d;switch(t){case"RSA-OAEP":d="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":d="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":d="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":d="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:d},i,s?["encrypt"]:["decrypt"]);a=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:d},i,[s?"verify":"sign"])}if(e.asymmetricKeyType==="ec"){let d=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");t==="ES256"&&d==="P-256"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:d},i,[s?"verify":"sign"])),t==="ES384"&&d==="P-384"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:d},i,[s?"verify":"sign"])),t==="ES512"&&d==="P-521"&&(a=e.toCryptoKey({name:"ECDSA",namedCurve:d},i,[s?"verify":"sign"])),t.startsWith("ECDH-ES")&&(a=e.toCryptoKey({name:"ECDH",namedCurve:d},i,s?[]:["deriveBits"]))}if(!a)throw TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=a:E.set(e,{[t]:a}),a};async function te(e,t){if(e instanceof Uint8Array||q(e))return e;if(ye(e)){if(e.type==="secret")return e.export();if("toCryptoKey"in e&&typeof e.toCryptoKey=="function")try{return Zt(e,t)}catch(r){if(r instanceof TypeError)throw r}let a=e.export({format:"jwk"});return pt(e,a,t)}if(we(e))return e.k?p(e.k):pt(e,e,t,!0);throw Error("unreachable")}let ae=e=>e?.[Symbol.toStringTag],_e=(e,t,a)=>{if(t.use!==void 0){let r;switch(a){case"sign":case"verify":r="sig";break;case"encrypt":case"decrypt":r="enc"}if(t.use!==r)throw TypeError(`Invalid key for this operation, its "use" must be "${r}" when present`)}if(t.alg!==void 0&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let r;switch(!0){case(a==="sign"||a==="verify"):case e==="dir":case e.includes("CBC-HS"):r=a;break;case e.startsWith("PBES2"):r="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):r=!e.includes("GCM")&&e.endsWith("KW")?a==="encrypt"?"wrapKey":"unwrapKey":a;break;case(a==="encrypt"&&e.startsWith("RSA")):r="wrapKey";break;case a==="decrypt":r=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(r&&t.key_ops?.includes?.(r)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${r}" when present`)}return!0},ea=(e,t,a)=>{if(!(t instanceof Uint8Array)){if(we(t)){if(Qt(t)&&_e(e,t,a))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Pe(t))throw TypeError(qe(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(t.type!=="secret")throw TypeError(`${ae(t)} instances for symmetric algorithms must be of type "secret"`)}},ta=(e,t,a)=>{if(we(t))switch(a){case"decrypt":case"sign":if(Xt(t)&&_e(e,t,a))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(qt(t)&&_e(e,t,a))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!Pe(t))throw TypeError(qe(e,t,"CryptoKey","KeyObject","JSON Web Key"));if(t.type==="secret")throw TypeError(`${ae(t)} instances for asymmetric algorithms must not be of type "secret"`);if(t.type==="public")switch(a){case"sign":throw TypeError(`${ae(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${ae(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if(t.type==="private")switch(a){case"verify":throw TypeError(`${ae(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${ae(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function le(e,t,a){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":ea(e,t,a);break;default:ta(e,t,a)}}async function De(e,t,a){let r,s,i,d,y,K,k;if(!U(e))throw new v("Flattened JWE must be an object");if(e.protected===void 0&&e.header===void 0&&e.unprotected===void 0)throw new v("JOSE Header missing");if(e.iv!==void 0&&typeof e.iv!="string")throw new v("JWE Initialization Vector incorrect type");if(typeof e.ciphertext!="string")throw new v("JWE Ciphertext missing or incorrect type");if(e.tag!==void 0&&typeof e.tag!="string")throw new v("JWE Authentication Tag incorrect type");if(e.protected!==void 0&&typeof e.protected!="string")throw new v("JWE Protected Header incorrect type");if(e.encrypted_key!==void 0&&typeof e.encrypted_key!="string")throw new v("JWE Encrypted Key incorrect type");if(e.aad!==void 0&&typeof e.aad!="string")throw new v("JWE AAD incorrect type");if(e.header!==void 0&&!U(e.header))throw new v("JWE Shared Unprotected Header incorrect type");if(e.unprotected!==void 0&&!U(e.unprotected))throw new v("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let se=p(e.protected);r=JSON.parse(l.decode(se))}catch{throw new v("JWE Protected Header is invalid")}if(!oe(r,e.header,e.unprotected))throw new v("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let P={...r,...e.header,...e.unprotected};if(ce(v,new Map,a?.crit,r,P),P.zip!==void 0)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:T,enc:J}=P;if(typeof T!="string"||!T)throw new v("missing JWE Algorithm (alg) in JWE Header");if(typeof J!="string"||!J)throw new v("missing JWE Encryption Algorithm (enc) in JWE Header");let D=a&&Ue("keyManagementAlgorithms",a.keyManagementAlgorithms),_=a&&Ue("contentEncryptionAlgorithms",a.contentEncryptionAlgorithms);if(D&&!D.has(T)||!D&&T.startsWith("PBES2"))throw new he('"alg" (Algorithm) Header Parameter value not allowed');if(_&&!_.has(J))throw new he('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(e.encrypted_key!==void 0)try{s=p(e.encrypted_key)}catch{throw new v("Failed to base64url decode the encrypted_key")}let N=!1;typeof t=="function"&&(t=await t(r,e),N=!0),le(T==="dir"?J:T,t,"decrypt");let x=await te(t,T);try{i=await Yt(T,x,s,P,a)}catch(se){if(se instanceof TypeError||se instanceof v||se instanceof H)throw se;i=Q(J)}if(e.iv!==void 0)try{d=p(e.iv)}catch{throw new v("Failed to base64url decode the iv")}if(e.tag!==void 0)try{y=p(e.tag)}catch{throw new v("Failed to base64url decode the tag")}let be=e.protected!==void 0?f(e.protected):new Uint8Array;K=e.aad!==void 0?h(be,f("."),f(e.aad)):be;try{k=p(e.ciphertext)}catch{throw new v("Failed to base64url decode the ciphertext")}let re={plaintext:await Qe(J,i,k,d,y,K)};if(e.protected!==void 0&&(re.protectedHeader=r),e.aad!==void 0)try{re.additionalAuthenticatedData=p(e.aad)}catch{throw new v("Failed to base64url decode the aad")}return e.unprotected!==void 0&&(re.sharedUnprotectedHeader=e.unprotected),e.header!==void 0&&(re.unprotectedHeader=e.header),N?{...re,key:x}:re}async function yt(e,t,a){if(e instanceof Uint8Array&&(e=l.decode(e)),typeof e!="string")throw new v("Compact JWE must be a string or Uint8Array");let{0:r,1:s,2:i,3:d,4:y,length:K}=e.split(".");if(K!==5)throw new v("Invalid Compact JWE");let k=await De({ciphertext:d,iv:i||void 0,protected:r,tag:y||void 0,encrypted_key:s||void 0},t,a),P={plaintext:k.plaintext,protectedHeader:k.protectedHeader};return typeof t=="function"?{...P,key:k.key}:P}async function aa(e,t,a){if(!U(e))throw new v("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(U))throw new v("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new v("JWE Recipients has no members");for(let r of e.recipients)try{return await De({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:r.encrypted_key,header:r.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,a)}catch{}throw new ie}let mt=Symbol();async function ra(e){if(ye(e)){if(e.type!=="secret")return e.export({format:"jwk"});e=e.export()}if(e instanceof Uint8Array)return{kty:"oct",k:I(e)};if(!q(e))throw TypeError(Y(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:a,alg:r,use:s,...i}=await crypto.subtle.exportKey("jwk",e);return i.kty==="AKP"&&(i.alg=r),i}async function sa(e){return Rt(e)}async function ia(e){return Jt(e)}async function Re(e){return ra(e)}async function ft(e,t,a,r,s={}){let i,d,y;switch(e){case"dir":y=a;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let K;if(ne(a),!rt(a))throw new H("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:k,apv:P}=s;K=s.epk?await te(s.epk,e):(await crypto.subtle.generateKey(a.algorithm,!0,["deriveBits"])).privateKey;let{x:T,y:J,crv:D,kty:_}=await Re(K),N=await at(a,K,e==="ECDH-ES"?t:e,e==="ECDH-ES"?Ie(t):parseInt(e.slice(-5,-2),10),k,P);if(d={epk:{x:T,crv:D,kty:_}},_==="EC"&&(d.epk.y=J),k&&(d.apu=I(k)),P&&(d.apv=I(P)),e==="ECDH-ES"){y=N;break}y=r||Q(t);let x=e.slice(-6);i=await ke(x,N,y);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":y=r||Q(t),ne(a),i=await _t(e,a,y);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{y=r||Q(t);let{p2c:K,p2s:k}=s;({encryptedKey:i,...d}=await Bt(e,a,y,K,k));break}case"A128KW":case"A192KW":case"A256KW":y=r||Q(t),i=await ke(e,a,y);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{y=r||Q(t);let{iv:K}=s;({encryptedKey:i,...d}=await Vt(e,a,y,K));break}default:throw new H('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:y,encryptedKey:i,parameters:d}}class Ae{#e;#t;#a;#r;#i;#n;#o;#s;constructor(t){if(!(t instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#e=t}setKeyManagementParameters(t){if(this.#s)throw TypeError("setKeyManagementParameters can only be called once");return this.#s=t,this}setProtectedHeader(t){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=t,this}setSharedUnprotectedHeader(t){if(this.#a)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#a=t,this}setUnprotectedHeader(t){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=t,this}setAdditionalAuthenticatedData(t){return this.#i=t,this}setContentEncryptionKey(t){if(this.#n)throw TypeError("setContentEncryptionKey can only be called once");return this.#n=t,this}setInitializationVector(t){if(this.#o)throw TypeError("setInitializationVector can only be called once");return this.#o=t,this}async encrypt(t,a){let r,s,i,d,y,K;if(!this.#t&&!this.#r&&!this.#a)throw new v("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!oe(this.#t,this.#r,this.#a))throw new v("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let k={...this.#t,...this.#r,...this.#a};if(ce(v,new Map,a?.crit,this.#t,k),k.zip!==void 0)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:P,enc:T}=k;if(typeof P!="string"||!P)throw new v('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof T!="string"||!T)throw new v('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#n&&(P==="dir"||P==="ECDH-ES"))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${P}`);le(P==="dir"?T:P,t,"encrypt");{let x,be=await te(t,P);({cek:s,encryptedKey:r,parameters:x}=await ft(P,T,be,this.#n,this.#s)),x&&(a&&mt in a?this.#r?this.#r={...this.#r,...x}:this.setUnprotectedHeader(x):this.#t?this.#t={...this.#t,...x}:this.setProtectedHeader(x))}if(this.#t?y=f(d=I(JSON.stringify(this.#t))):(d="",y=new Uint8Array),this.#i){let x=f(K=I(this.#i));i=h(y,f("."),x)}else i=y;let{ciphertext:J,tag:D,iv:_}=await ut(T,this.#e,s,this.#o,i),N={ciphertext:I(J)};return _&&(N.iv=I(_)),D&&(N.tag=I(D)),r&&(N.encrypted_key=I(r)),K&&(N.aad=K),this.#t&&(N.protected=d),this.#a&&(N.unprotected=this.#a),this.#r&&(N.header=this.#r),N}}class na{#e;unprotectedHeader;keyManagementParameters;key;options;constructor(t,a,r){this.#e=t,this.key=a,this.options=r}setUnprotectedHeader(t){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}setKeyManagementParameters(t){if(this.keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this.keyManagementParameters=t,this}addRecipient(...t){return this.#e.addRecipient(...t)}encrypt(...t){return this.#e.encrypt(...t)}done(){return this.#e}}class oa{#e;#t=[];#a;#r;#i;constructor(t){this.#e=t}addRecipient(t,a){let r=new na(this,t,{crit:a?.crit});return this.#t.push(r),r}setProtectedHeader(t){if(this.#a)throw TypeError("setProtectedHeader can only be called once");return this.#a=t,this}setSharedUnprotectedHeader(t){if(this.#r)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#r=t,this}setAdditionalAuthenticatedData(t){return this.#i=t,this}async encrypt(){let t;if(!this.#t.length)throw new v("at least one recipient must be added");if(this.#t.length===1){let[s]=this.#t,i=await new Ae(this.#e).setAdditionalAuthenticatedData(this.#i).setProtectedHeader(this.#a).setSharedUnprotectedHeader(this.#r).setUnprotectedHeader(s.unprotectedHeader).encrypt(s.key,{...s.options}),d={ciphertext:i.ciphertext,iv:i.iv,recipients:[{}],tag:i.tag};return i.aad&&(d.aad=i.aad),i.protected&&(d.protected=i.protected),i.unprotected&&(d.unprotected=i.unprotected),i.encrypted_key&&(d.recipients[0].encrypted_key=i.encrypted_key),i.header&&(d.recipients[0].header=i.header),d}for(let s=0;s<this.#t.length;s++){let i=this.#t[s];if(!oe(this.#a,this.#r,i.unprotectedHeader))throw new v("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let d={...this.#a,...this.#r,...i.unprotectedHeader},{alg:y}=d;if(typeof y!="string"||!y)throw new v('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(y==="dir"||y==="ECDH-ES")throw new v('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof d.enc!="string"||!d.enc)throw new v('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(t){if(t!==d.enc)throw new v('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else t=d.enc;if(ce(v,new Map,i.options.crit,this.#a,d),d.zip!==void 0)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}let a=Q(t),r={ciphertext:"",recipients:[]};for(let s=0;s<this.#t.length;s++){let i=this.#t[s],d={};if(r.recipients.push(d),s===0){let T=await new Ae(this.#e).setAdditionalAuthenticatedData(this.#i).setContentEncryptionKey(a).setProtectedHeader(this.#a).setSharedUnprotectedHeader(this.#r).setUnprotectedHeader(i.unprotectedHeader).setKeyManagementParameters(i.keyManagementParameters).encrypt(i.key,{...i.options,[mt]:!0});r.ciphertext=T.ciphertext,r.iv=T.iv,r.tag=T.tag,T.aad&&(r.aad=T.aad),T.protected&&(r.protected=T.protected),T.unprotected&&(r.unprotected=T.unprotected),d.encrypted_key=T.encrypted_key,T.header&&(d.header=T.header);continue}let y=i.unprotectedHeader?.alg||this.#a?.alg||this.#r?.alg;le(y==="dir"?t:y,i.key,"encrypt");let K=await te(i.key,y),{encryptedKey:k,parameters:P}=await ft(y,t,K,a,i.keyManagementParameters);d.encrypted_key=I(k),(i.unprotectedHeader||P)&&(d.header={...i.unprotectedHeader,...P})}return r}}function gt(e,t){let a=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:a,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:a,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:a,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:a,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new H(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function wt(e,t,a){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(Y(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[a])}return function(r,s,i){switch(s){case"HS256":case"HS384":case"HS512":{if(!F(r.algorithm,"HMAC"))throw R("HMAC");let d=parseInt(s.slice(2),10);if(pe(r.algorithm.hash)!==d)throw R(`SHA-${d}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!F(r.algorithm,"RSASSA-PKCS1-v1_5"))throw R("RSASSA-PKCS1-v1_5");let d=parseInt(s.slice(2),10);if(pe(r.algorithm.hash)!==d)throw R(`SHA-${d}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!F(r.algorithm,"RSA-PSS"))throw R("RSA-PSS");let d=parseInt(s.slice(2),10);if(pe(r.algorithm.hash)!==d)throw R(`SHA-${d}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!F(r.algorithm,"Ed25519"))throw R("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!F(r.algorithm,s))throw R(s);break;case"ES256":case"ES384":case"ES512":{if(!F(r.algorithm,"ECDSA"))throw R("ECDSA");let d=function(y){switch(y){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(s);if(r.algorithm.namedCurve!==d)throw R(d,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}Ye(r,i)}(t,e,a),t}async function ca(e,t,a,r){let s=await wt(e,t,"verify");me(e,s);let i=gt(e,s.algorithm);try{return await crypto.subtle.verify(i,s,a,r)}catch{return!1}}async function Je(e,t,a){let r,s;if(!U(e))throw new O("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new O('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new O("JWS Protected Header incorrect type");if(e.payload===void 0)throw new O("JWS Payload missing");if(typeof e.signature!="string")throw new O("JWS Signature missing or incorrect type");if(e.header!==void 0&&!U(e.header))throw new O("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let N=p(e.protected);i=JSON.parse(l.decode(N))}catch{throw new O("JWS Protected Header is invalid")}if(!oe(i,e.header))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...i,...e.header},y=ce(O,new Map([["b64",!0]]),a?.crit,i,d),K=!0;if(y.has("b64")&&typeof(K=i.b64)!="boolean")throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:k}=d;if(typeof k!="string"||!k)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');let P=a&&Ue("algorithms",a.algorithms);if(P&&!P.has(k))throw new he('"alg" (Algorithm) Header Parameter value not allowed');if(K){if(typeof e.payload!="string")throw new O("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new O("JWS Payload must be a string or an Uint8Array instance");let T=!1;typeof t=="function"&&(t=await t(i,e),T=!0),le(k,t,"verify");let J=h(e.protected!==void 0?f(e.protected):new Uint8Array,f("."),typeof e.payload=="string"?K?f(e.payload):n.encode(e.payload):e.payload);try{r=p(e.signature)}catch{throw new O("Failed to base64url decode the signature")}let D=await te(t,k);if(!await ca(k,D,r,J))throw new Ce;if(K)try{s=p(e.payload)}catch{throw new O("Failed to base64url decode the payload")}else s=typeof e.payload=="string"?n.encode(e.payload):e.payload;let _={payload:s};return e.protected!==void 0&&(_.protectedHeader=i),e.header!==void 0&&(_.unprotectedHeader=e.header),T?{..._,key:D}:_}async function At(e,t,a){if(e instanceof Uint8Array&&(e=l.decode(e)),typeof e!="string")throw new O("Compact JWS must be a string or Uint8Array");let{0:r,1:s,2:i,length:d}=e.split(".");if(d!==3)throw new O("Invalid Compact JWS");let y=await Je({payload:s,protected:r,signature:i},t,a),K={payload:y.payload,protectedHeader:y.protectedHeader};return typeof t=="function"?{...K,key:y.key}:K}async function la(e,t,a){if(!U(e))throw new O("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(U))throw new O("JWS Signatures missing or incorrect type");for(let r of e.signatures)try{return await Je({header:r.header,payload:e.payload,protected:r.protected,signature:r.signature},t,a)}catch{}throw new Ce}let X=e=>Math.floor(e.getTime()/1e3),da=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function de(e){let t,a=da.exec(e);if(!a||a[4]&&a[1])throw TypeError("Invalid time period format");let r=parseFloat(a[2]);switch(a[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*r);break;case"day":case"days":case"d":t=Math.round(86400*r);break;case"week":case"weeks":case"w":t=Math.round(604800*r);break;default:t=Math.round(31557600*r)}return a[1]==="-"||a[4]==="ago"?-t:t}function Z(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let St=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,ha=(e,t)=>typeof e=="string"?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e)));function Ne(e,t,a={}){let r,s;try{r=JSON.parse(l.decode(t))}catch{}if(!U(r))throw new M("JWT Claims Set must be a top-level JSON object");let{typ:i}=a;if(i&&(typeof e.typ!="string"||St(e.typ)!==St(i)))throw new B('unexpected "typ" JWT header value',r,"typ","check_failed");let{requiredClaims:d=[],issuer:y,subject:K,audience:k,maxTokenAge:P}=a,T=[...d];for(let _ of(P!==void 0&&T.push("iat"),k!==void 0&&T.push("aud"),K!==void 0&&T.push("sub"),y!==void 0&&T.push("iss"),new Set(T.reverse())))if(!(_ in r))throw new B(`missing required "${_}" claim`,r,_,"missing");if(y&&!(Array.isArray(y)?y:[y]).includes(r.iss))throw new B('unexpected "iss" claim value',r,"iss","check_failed");if(K&&r.sub!==K)throw new B('unexpected "sub" claim value',r,"sub","check_failed");if(k&&!ha(r.aud,typeof k=="string"?[k]:k))throw new B('unexpected "aud" claim value',r,"aud","check_failed");switch(typeof a.clockTolerance){case"string":s=de(a.clockTolerance);break;case"number":s=a.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:J}=a,D=X(J||new Date);if((r.iat!==void 0||P)&&typeof r.iat!="number")throw new B('"iat" claim must be a number',r,"iat","invalid");if(r.nbf!==void 0){if(typeof r.nbf!="number")throw new B('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>D+s)throw new B('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(r.exp!==void 0){if(typeof r.exp!="number")throw new B('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=D-s)throw new ee('"exp" claim timestamp check failed',r,"exp","check_failed")}if(P){let _=D-r.iat;if(_-s>(typeof P=="number"?P:de(P)))throw new ee('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(_<0-s)throw new B('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r}class Le{#e;constructor(t){if(!U(t))throw TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(t)}data(){return n.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(t){this.#e.iss=t}get sub(){return this.#e.sub}set sub(t){this.#e.sub=t}get aud(){return this.#e.aud}set aud(t){this.#e.aud=t}set jti(t){this.#e.jti=t}set nbf(t){typeof t=="number"?this.#e.nbf=Z("setNotBefore",t):t instanceof Date?this.#e.nbf=Z("setNotBefore",X(t)):this.#e.nbf=X(new Date)+de(t)}set exp(t){typeof t=="number"?this.#e.exp=Z("setExpirationTime",t):t instanceof Date?this.#e.exp=Z("setExpirationTime",X(t)):this.#e.exp=X(new Date)+de(t)}set iat(t){t===void 0?this.#e.iat=X(new Date):t instanceof Date?this.#e.iat=Z("setIssuedAt",X(t)):typeof t=="string"?this.#e.iat=Z("setIssuedAt",X(new Date)+de(t)):this.#e.iat=Z("setIssuedAt",t)}}async function ua(e,t,a){let r=await At(e,t,a);if(r.protectedHeader.crit?.includes("b64")&&r.protectedHeader.b64===!1)throw new M("JWTs MUST NOT use unencoded payload");let s={payload:Ne(r.protectedHeader,r.payload,a),protectedHeader:r.protectedHeader};return typeof t=="function"?{...s,key:r.key}:s}async function pa(e,t,a){let r=await yt(e,t,a),s=Ne(r.protectedHeader,r.plaintext,a),{protectedHeader:i}=r;if(i.iss!==void 0&&i.iss!==s.iss)throw new B('replicated "iss" claim header parameter mismatch',s,"iss","mismatch");if(i.sub!==void 0&&i.sub!==s.sub)throw new B('replicated "sub" claim header parameter mismatch',s,"sub","mismatch");if(i.aud!==void 0&&JSON.stringify(i.aud)!==JSON.stringify(s.aud))throw new B('replicated "aud" claim header parameter mismatch',s,"aud","mismatch");let d={payload:s,protectedHeader:i};return typeof t=="function"?{...d,key:r.key}:d}class bt{#e;constructor(t){this.#e=new Ae(t)}setContentEncryptionKey(t){return this.#e.setContentEncryptionKey(t),this}setInitializationVector(t){return this.#e.setInitializationVector(t),this}setProtectedHeader(t){return this.#e.setProtectedHeader(t),this}setKeyManagementParameters(t){return this.#e.setKeyManagementParameters(t),this}async encrypt(t,a){let r=await this.#e.encrypt(t,a);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}async function ya(e,t,a){let r=await wt(e,t,"sign");return me(e,r),new Uint8Array(await crypto.subtle.sign(gt(e,r.algorithm),r,a))}class $e{#e;#t;#a;constructor(t){if(!(t instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=t}setProtectedHeader(t){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=t,this}setUnprotectedHeader(t){if(this.#a)throw TypeError("setUnprotectedHeader can only be called once");return this.#a=t,this}async sign(t,a){let r,s,i,d;if(!this.#t&&!this.#a)throw new O("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!oe(this.#t,this.#a))throw new O("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let y={...this.#t,...this.#a},K=ce(O,new Map([["b64",!0]]),a?.crit,this.#t,y),k=!0;if(K.has("b64")&&typeof(k=this.#t.b64)!="boolean")throw new O('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:P}=y;if(typeof P!="string"||!P)throw new O('JWS "alg" (Algorithm) Header Parameter missing or invalid');le(P,t,"sign"),k?s=f(r=I(this.#e)):(s=this.#e,r=""),this.#t?d=f(i=I(JSON.stringify(this.#t))):(i="",d=new Uint8Array);let T=h(d,f("."),s),J=await te(t,P),D={signature:I(await ya(P,J,T)),payload:r};return this.#a&&(D.header=this.#a),this.#t&&(D.protected=i),D}}class Et{#e;constructor(t){this.#e=new $e(t)}setProtectedHeader(t){return this.#e.setProtectedHeader(t),this}async sign(t,a){let r=await this.#e.sign(t,a);if(r.payload===void 0)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class ma{#e;protectedHeader;unprotectedHeader;options;key;constructor(t,a,r){this.#e=t,this.key=a,this.options=r}setProtectedHeader(t){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=t,this}setUnprotectedHeader(t){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}addSignature(...t){return this.#e.addSignature(...t)}sign(...t){return this.#e.sign(...t)}done(){return this.#e}}class fa{#e;#t=[];constructor(t){this.#e=t}addSignature(t,a){let r=new ma(this,t,a);return this.#t.push(r),r}async sign(){if(!this.#t.length)throw new O("at least one signature must be added");let t={signatures:[],payload:""};for(let a=0;a<this.#t.length;a++){let r=this.#t[a],s=new $e(this.#e);s.setProtectedHeader(r.protectedHeader),s.setUnprotectedHeader(r.unprotectedHeader);let{payload:i,...d}=await s.sign(r.key,r.options);if(a===0)t.payload=i;else if(t.payload!==i)throw new O("inconsistent use of JWS Unencoded Payload (RFC7797)");t.signatures.push(d)}return t}}class ga{#e;#t;constructor(t={}){this.#t=new Le(t)}setIssuer(t){return this.#t.iss=t,this}setSubject(t){return this.#t.sub=t,this}setAudience(t){return this.#t.aud=t,this}setJti(t){return this.#t.jti=t,this}setNotBefore(t){return this.#t.nbf=t,this}setExpirationTime(t){return this.#t.exp=t,this}setIssuedAt(t){return this.#t.iat=t,this}setProtectedHeader(t){return this.#e=t,this}async sign(t,a){let r=new Et(this.#t.data());if(r.setProtectedHeader(this.#e),Array.isArray(this.#e?.crit)&&this.#e.crit.includes("b64")&&this.#e.b64===!1)throw new M("JWTs MUST NOT use unencoded payload");return r.sign(t,a)}}class wa{#e;#t;#a;#r;#i;#n;#o;#s;constructor(t={}){this.#s=new Le(t)}setIssuer(t){return this.#s.iss=t,this}setSubject(t){return this.#s.sub=t,this}setAudience(t){return this.#s.aud=t,this}setJti(t){return this.#s.jti=t,this}setNotBefore(t){return this.#s.nbf=t,this}setExpirationTime(t){return this.#s.exp=t,this}setIssuedAt(t){return this.#s.iat=t,this}setProtectedHeader(t){if(this.#r)throw TypeError("setProtectedHeader can only be called once");return this.#r=t,this}setKeyManagementParameters(t){if(this.#a)throw TypeError("setKeyManagementParameters can only be called once");return this.#a=t,this}setContentEncryptionKey(t){if(this.#e)throw TypeError("setContentEncryptionKey can only be called once");return this.#e=t,this}setInitializationVector(t){if(this.#t)throw TypeError("setInitializationVector can only be called once");return this.#t=t,this}replicateIssuerAsHeader(){return this.#i=!0,this}replicateSubjectAsHeader(){return this.#n=!0,this}replicateAudienceAsHeader(){return this.#o=!0,this}async encrypt(t,a){let r=new bt(this.#s.data());return this.#r&&(this.#i||this.#n||this.#o)&&(this.#r={...this.#r,iss:this.#i?this.#s.iss:void 0,sub:this.#n?this.#s.sub:void 0,aud:this.#o?this.#s.aud:void 0}),r.setProtectedHeader(this.#r),this.#t&&r.setInitializationVector(this.#t),this.#e&&r.setContentEncryptionKey(this.#e),this.#a&&r.setKeyManagementParameters(this.#a),r.encrypt(t,a)}}let V=(e,t)=>{if(typeof e!="string"||!e)throw new je(`${t} missing or invalid`)};async function vt(e,t){let a,r;if(we(e))a=e;else if(Pe(e))a=await Re(e);else throw TypeError(Y(e,"CryptoKey","KeyObject","JSON Web Key"));if((t??="sha256")!=="sha256"&&t!=="sha384"&&t!=="sha512")throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(a.kty){case"AKP":V(a.alg,'"alg" (Algorithm) Parameter'),V(a.pub,'"pub" (Public key) Parameter'),r={alg:a.alg,kty:a.kty,pub:a.pub};break;case"EC":V(a.crv,'"crv" (Curve) Parameter'),V(a.x,'"x" (X Coordinate) Parameter'),V(a.y,'"y" (Y Coordinate) Parameter'),r={crv:a.crv,kty:a.kty,x:a.x,y:a.y};break;case"OKP":V(a.crv,'"crv" (Subtype of Key Pair) Parameter'),V(a.x,'"x" (Public Key) Parameter'),r={crv:a.crv,kty:a.kty,x:a.x};break;case"RSA":V(a.e,'"e" (Exponent) Parameter'),V(a.n,'"n" (Modulus) Parameter'),r={e:a.e,kty:a.kty,n:a.n};break;case"oct":V(a.k,'"k" (Key Value) Parameter'),r={k:a.k,kty:a.kty};break;default:throw new H('"kty" (Key Type) Parameter missing or unsupported')}let s=f(JSON.stringify(r));return I(await tt(t,s))}async function Aa(e,t){t??="sha256";let a=await vt(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${a}`}async function Sa(e,t){let a={...e,...t?.header};if(!U(a.jwk))throw new O('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let r=await ge({...a.jwk,ext:!0},a.alg);if(r instanceof Uint8Array||r.type!=="public")throw new O('"jwk" (JSON Web Key) Header Parameter must be a public key');return r}function ba(e){return U(e)}class Ea{#e;#t=new WeakMap;constructor(t){if(!function(a){return a&&typeof a=="object"&&Array.isArray(a.keys)&&a.keys.every(ba)}(t))throw new Ee("JSON Web Key Set malformed");this.#e=structuredClone(t)}jwks(){return this.#e}async getKey(t,a){let{alg:r,kid:s}={...t,...a?.header},i=function(k){switch(typeof k=="string"&&k.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new H('Unsupported "alg" value for a JSON Web Key Set')}}(r),d=this.#e.keys.filter(k=>{let P=i===k.kty;if(P&&typeof s=="string"&&(P=s===k.kid),P&&(typeof k.alg=="string"||i==="AKP")&&(P=r===k.alg),P&&typeof k.use=="string"&&(P=k.use==="sig"),P&&Array.isArray(k.key_ops)&&(P=k.key_ops.includes("verify")),P)switch(r){case"ES256":P=k.crv==="P-256";break;case"ES384":P=k.crv==="P-384";break;case"ES512":P=k.crv==="P-521";break;case"Ed25519":case"EdDSA":P=k.crv==="Ed25519"}return P}),{0:y,length:K}=d;if(K===0)throw new ve;if(K!==1){let k=new Fe,P=this.#t;throw k[Symbol.asyncIterator]=async function*(){for(let T of d)try{yield await Ct(P,T,r)}catch{}},k}return Ct(this.#t,y,r)}}async function Ct(e,t,a){let r=e.get(t)||e.set(t,{}).get(t);if(r[a]===void 0){let s=await ge({...t,ext:!0},a);if(s instanceof Uint8Array||s.type!=="public")throw new Ee("JSON Web Key Set members must be public keys");r[a]=s}return r[a]}function Me(e){let t=new Ea(e),a=async(r,s)=>t.getKey(r,s);return Object.defineProperties(a,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),a}typeof navigator<"u"&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(w="jose/v6.1.2");let Pt=Symbol();async function va(e,t,a,r=fetch){let s=await r(e,{method:"GET",signal:a,redirect:"manual",headers:t}).catch(i=>{throw i.name==="TimeoutError"?new Ge:i});if(s.status!==200)throw new W("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch{throw new W("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let Se=Symbol();class Ca{#e;#t;#a;#r;#i;#n;#o;#s;#c;#l;constructor(t,a){if(!(t instanceof URL))throw TypeError("url must be an instance of URL");this.#e=new URL(t.href),this.#t=typeof a?.timeoutDuration=="number"?a?.timeoutDuration:5e3,this.#a=typeof a?.cooldownDuration=="number"?a?.cooldownDuration:3e4,this.#r=typeof a?.cacheMaxAge=="number"?a?.cacheMaxAge:6e5,this.#o=new Headers(a?.headers),w&&!this.#o.has("User-Agent")&&this.#o.set("User-Agent",w),this.#o.has("accept")||(this.#o.set("accept","application/json"),this.#o.append("accept","application/jwk-set+json")),this.#s=a?.[Pt],a?.[Se]!==void 0&&(this.#l=a?.[Se],function(r,s){return!!(!(typeof r!="object"||r===null||!("uat"in r)||typeof r.uat!="number"||Date.now()-r.uat>=s)&&"jwks"in r&&U(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,U))}(a?.[Se],this.#r)&&(this.#i=this.#l.uat,this.#c=Me(this.#l.jwks)))}pendingFetch(){return!!this.#n}coolingDown(){return typeof this.#i=="number"&&Date.now()<this.#i+this.#a}fresh(){return typeof this.#i=="number"&&Date.now()<this.#i+this.#r}jwks(){return this.#c?.jwks()}async getKey(t,a){this.#c&&this.fresh()||await this.reload();try{return await this.#c(t,a)}catch(r){if(r instanceof ve&&this.coolingDown()===!1)return await this.reload(),this.#c(t,a);throw r}}async reload(){this.#n&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent,1)&&(this.#n=void 0),this.#n||=va(this.#e.href,this.#o,AbortSignal.timeout(this.#t),this.#s).then(t=>{this.#c=Me(t),this.#l&&(this.#l.uat=Date.now(),this.#l.jwks=t),this.#i=Date.now(),this.#n=void 0}).catch(t=>{throw this.#n=void 0,t}),await this.#n}}function Pa(e,t){let a=new Ca(e,t),r=async(s,i)=>a.getKey(s,i);return Object.defineProperties(r,{coolingDown:{get:()=>a.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>a.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>a.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>a.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>a.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r}class ka{#e;constructor(t={}){this.#e=new Le(t)}encode(){let t=I(JSON.stringify({alg:"none"})),a=I(this.#e.data());return`${t}.${a}.`}setIssuer(t){return this.#e.iss=t,this}setSubject(t){return this.#e.sub=t,this}setAudience(t){return this.#e.aud=t,this}setJti(t){return this.#e.jti=t,this}setNotBefore(t){return this.#e.nbf=t,this}setExpirationTime(t){return this.#e.exp=t,this}setIssuedAt(t){return this.#e.iat=t,this}static decode(t,a){let r;if(typeof t!="string")throw new M("Unsecured JWT must be a string");let{0:s,1:i,2:d,length:y}=t.split(".");if(y!==3||d!=="")throw new M("Invalid Unsecured JWT");try{if(r=JSON.parse(l.decode(p(s))),r.alg!=="none")throw Error()}catch{throw new M("Invalid Unsecured JWT")}return{payload:Ne(r,p(i),a),header:r}}}function Ka(e){let t;if(typeof e=="string"){let a=e.split(".");(a.length===3||a.length===5)&&([t]=a)}else if(typeof e=="object"&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if(typeof t!="string"||!t)throw Error();let a=JSON.parse(l.decode(p(t)));if(!U(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function Ta(e){let t,a;if(typeof e!="string")throw new M("JWTs must use Compact JWS serialization, JWT must be a string");let{1:r,length:s}=e.split(".");if(s===5)throw new M("Only JWTs using Compact JWS serialization can be decoded");if(s!==3)throw new M("Invalid JWT");if(!r)throw new M("JWTs must contain a payload");try{t=p(r)}catch{throw new M("Failed to base64url decode the payload")}try{a=JSON.parse(l.decode(t))}catch{throw new M("Failed to parse the decoded payload as JSON")}if(!U(a))throw new M("Invalid JWT Claims Set");return a}function xe(e){let t=e?.modulusLength??2048;if(typeof t!="number"||t<2048)throw new H("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function Ia(e,t){let a,r;switch(e){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:xe(t)},r=["sign","verify"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:xe(t)},r=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:Uint8Array.of(1,0,1),modulusLength:xe(t)},r=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},r=["sign","verify"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},r=["sign","verify"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},r=["sign","verify"];break;case"Ed25519":case"EdDSA":r=["sign","verify"],a={name:"Ed25519"};break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":r=["sign","verify"],a={name:e};break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{r=["deriveBits"];let s=t?.crv??"P-256";switch(s){case"P-256":case"P-384":case"P-521":a={name:"ECDH",namedCurve:s};break;case"X25519":a={name:"X25519"};break;default:throw new H("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, and X25519")}break}default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(a,t?.extractable??!1,r)}async function Wa(e,t){let a,r,s;switch(e){case"HS256":case"HS384":case"HS512":a=parseInt(e.slice(-3),10),r={name:"HMAC",hash:`SHA-${a}`,length:a},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return a=parseInt(e.slice(-3),10),crypto.getRandomValues(new Uint8Array(a>>3));case"A128KW":case"A192KW":case"A256KW":r={name:"AES-KW",length:a=parseInt(e.slice(1,4),10)},s=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r={name:"AES-GCM",length:a=parseInt(e.slice(1,4),10)},s=["encrypt","decrypt"];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return crypto.subtle.generateKey(r,t?.extractable??!1,s)}let Ha="WebCryptoAPI"},L);export{_a as __getNamedExports};
